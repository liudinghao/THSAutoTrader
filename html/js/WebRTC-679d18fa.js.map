{"version":3,"file":"WebRTC-679d18fa.js","sources":["../../front/src/views/WebRTC.vue"],"sourcesContent":["<template>\r\n  <div class=\"webrtc-container\">\r\n    <el-card class=\"connection-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <h3>WebRTC 实时通信</h3>\r\n          <el-button \r\n            type=\"primary\" \r\n            :icon=\"Link\"\r\n            @click=\"toggleConnection\"\r\n            :loading=\"connecting\"\r\n          >\r\n            {{ isConnected ? '断开连接' : '建立连接' }}\r\n          </el-button>\r\n        </div>\r\n      </template>\r\n\r\n      <div class=\"connection-info\">\r\n        <el-form :model=\"connectionForm\" label-width=\"120px\">\r\n          <el-form-item label=\"信令服务器地址\">\r\n            <el-input \r\n              v-model=\"connectionForm.signalingServer\" \r\n              placeholder=\"ws://localhost:8000\"\r\n            />\r\n          </el-form-item>\r\n          <el-form-item label=\"房间ID\">\r\n            <el-input \r\n              v-model=\"connectionForm.roomId\" \r\n              placeholder=\"输入房间ID\"\r\n            />\r\n          </el-form-item>\r\n          <el-form-item label=\"用户ID\">\r\n            <el-input \r\n              v-model=\"connectionForm.userId\" \r\n              placeholder=\"输入用户ID\"\r\n            />\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n\r\n      <div class=\"status-panel\">\r\n        <el-tag :type=\"connectionStatus.type\">\r\n          {{ connectionStatus.text }}\r\n        </el-tag>\r\n        <span class=\"peer-count\">\r\n          已连接: {{ peerCount }} 个节点\r\n        </span>\r\n      </div>\r\n    </el-card>\r\n\r\n    <el-row :gutter=\"20\" class=\"content-row\">\r\n      <el-col :span=\"12\">\r\n        <el-card class=\"message-card\">\r\n          <template #header>\r\n            <h4>发送消息</h4>\r\n          </template>\r\n          <el-input\r\n            v-model=\"messageInput\"\r\n            type=\"textarea\"\r\n            :rows=\"4\"\r\n            placeholder=\"输入要发送的消息\"\r\n          />\r\n          <div class=\"message-actions\">\r\n            <el-button \r\n              type=\"primary\" \r\n              @click=\"sendMessage\"\r\n              :disabled=\"!isConnected\"\r\n            >\r\n              发送消息\r\n            </el-button>\r\n            <el-button \r\n              @click=\"sendTestData\"\r\n              :disabled=\"!isConnected\"\r\n            >\r\n              发送测试数据\r\n            </el-button>\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n\r\n      <el-col :span=\"12\">\r\n        <el-card class=\"message-card\">\r\n          <template #header>\r\n            <h4>接收消息</h4>\r\n          </template>\r\n          <div class=\"message-list\">\r\n            <div \r\n              v-for=\"(msg, index) in receivedMessages\" \r\n              :key=\"index\"\r\n              class=\"message-item\"\r\n            >\r\n              <div class=\"message-meta\">\r\n                <span class=\"sender\">{{ msg.sender }}</span>\r\n                <span class=\"time\">{{ formatTime(msg.timestamp) }}</span>\r\n              </div>\r\n              <div class=\"message-content\">{{ msg.content }}</div>\r\n            </div>\r\n            <div v-if=\"receivedMessages.length === 0\" class=\"empty-message\">\r\n              暂无消息\r\n            </div>\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, onUnmounted } from 'vue';\r\nimport { Link } from '@element-plus/icons-vue';\r\nimport { ElMessage } from 'element-plus';\r\n\r\n// 状态管理\r\nconst connectionForm = ref({\r\n  signalingServer: 'ws://localhost:8000',\r\n  roomId: 'default-room',\r\n  userId: `user_${Math.random().toString(36).substr(2, 9)}`\r\n});\r\n\r\nconst messageInput = ref('');\r\nconst receivedMessages = ref([]);\r\nconst connecting = ref(false);\r\nconst isConnected = ref(false);\r\nconst peerCount = ref(0);\r\n\r\n// WebRTC相关变量\r\nlet signalingSocket = null;\r\nlet peerConnections = new Map();\r\nlet dataChannels = new Map();\r\n\r\n// 计算属性\r\nconst connectionStatus = computed(() => {\r\n  if (isConnected.value) {\r\n    return { type: 'success', text: '已连接' };\r\n  } else if (connecting.value) {\r\n    return { type: 'warning', text: '连接中...' };\r\n  } else {\r\n    return { type: 'info', text: '未连接' };\r\n  }\r\n});\r\n\r\n// 连接管理\r\nconst toggleConnection = async () => {\r\n  if (isConnected.value) {\r\n    disconnect();\r\n  } else {\r\n    await connect();\r\n  }\r\n};\r\n\r\nconst connect = async () => {\r\n  connecting.value = true;\r\n  try {\r\n    await connectToSignalingServer();\r\n    ElMessage.success('连接信令服务器成功');\r\n  } catch (error) {\r\n    ElMessage.error(`连接失败: ${error.message}`);\r\n    connecting.value = false;\r\n  }\r\n};\r\n\r\nconst disconnect = () => {\r\n  if (signalingSocket) {\r\n    signalingSocket.close();\r\n  }\r\n  // 清理所有连接\r\n  peerConnections.forEach(peer => {\r\n    try {\r\n      peer.close();\r\n    } catch (error) {\r\n      // 忽略关闭失败\r\n    }\r\n  });\r\n  \r\n  dataChannels.forEach(channel => {\r\n    try {\r\n      channel.close();\r\n    } catch (error) {\r\n      // 忽略关闭失败\r\n    }\r\n  });\r\n  \r\n  peerConnections.clear();\r\n  dataChannels.clear();\r\n  \r\n  isConnected.value = false;\r\n  connecting.value = false;\r\n  peerCount.value = 0;\r\n  \r\n  ElMessage.info('连接已断开');\r\n};\r\n\r\n// 信令服务器连接\r\nconst connectToSignalingServer = () => {\r\n  return new Promise((resolve, reject) => {\r\n    signalingSocket = new WebSocket(connectionForm.value.signalingServer);\r\n    \r\n    signalingSocket.onopen = () => {\r\n      isConnected.value = true;\r\n      connecting.value = false;\r\n      \r\n      // 发送加入房间消息\r\n      signalingSocket.send(JSON.stringify({\r\n        type: 'join',\r\n        room: connectionForm.value.roomId,\r\n        user: connectionForm.value.userId\r\n      }));\r\n      \r\n      resolve();\r\n    };\r\n    \r\n    signalingSocket.onmessage = (event) => {\r\n      try {\r\n        const message = JSON.parse(event.data);\r\n        handleSignalingMessage(message);\r\n      } catch (error) {\r\n        // JSON解析失败，忽略无效消息\r\n      }\r\n    };\r\n    \r\n    signalingSocket.onerror = (error) => {\r\n      reject(error);\r\n    };\r\n    \r\n    signalingSocket.onclose = () => {\r\n      isConnected.value = false;\r\n      connecting.value = false;\r\n      \r\n      // WebSocket断开时清理所有WebRTC连接\r\n      peerConnections.forEach((pc, userId) => {\r\n        cleanupPeerConnection(userId);\r\n      });\r\n      \r\n      signalingSocket = null;\r\n    };\r\n  });\r\n};\r\n\r\n// 处理信令消息\r\nconst handleSignalingMessage = (message) => {\r\n  switch (message.type) {\r\n    case 'offer':\r\n      handleOffer(message);\r\n      break;\r\n    case 'answer':\r\n      handleAnswer(message);\r\n      break;\r\n    case 'ice-candidate':\r\n      handleIceCandidate(message);\r\n      break;\r\n    case 'user-joined':\r\n      handleUserJoined(message);\r\n      break;\r\n    case 'user-left':\r\n      handleUserLeft(message);\r\n      break;\r\n    case 'room-users':\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n};\r\n\r\n// WebRTC连接建立\r\nconst createPeerConnection = (targetUserId) => {\r\n  const config = {\r\n    iceServers: [\r\n      { urls: 'stun:stun.l.google.com:19302' }\r\n    ]\r\n  };\r\n  \r\n  const pc = new RTCPeerConnection(config);\r\n  \r\n  // 保存PeerConnection到Map中\r\n  peerConnections.set(targetUserId, pc);\r\n  \r\n  // 添加连接状态监控\r\n  pc.oniceconnectionstatechange = () => {\r\n    if (pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'disconnected') {\r\n      // 连接失败或断开，延迟清理资源\r\n      setTimeout(() => {\r\n        if (pc.iceConnectionState === 'failed' || pc.iceConnectionState === 'disconnected') {\r\n          cleanupPeerConnection(targetUserId);\r\n        }\r\n      }, 5000); // 5秒后再次检查\r\n    }\r\n  };\r\n  \r\n  pc.onsignalingstatechange = () => {\r\n    // 信令状态变化处理\r\n  };\r\n  \r\n  pc.onconnectionstatechange = () => {\r\n    if (pc.connectionState === 'failed' || pc.connectionState === 'closed') {\r\n      cleanupPeerConnection(targetUserId);\r\n    }\r\n  };\r\n  \r\n  // 监听数据通道事件（Answer方）\r\n  pc.ondatachannel = (event) => {\r\n    setupDataChannel(event.channel, targetUserId);\r\n  };\r\n  \r\n  // 监听ICE候选\r\n  pc.onicecandidate = (event) => {\r\n    if (event.candidate && signalingSocket && signalingSocket.readyState === WebSocket.OPEN) {\r\n      try {\r\n        signalingSocket.send(JSON.stringify({\r\n          type: 'ice-candidate',\r\n          candidate: event.candidate,\r\n          target: targetUserId\r\n        }));\r\n      } catch (error) {\r\n        // 发送ICE候选失败\r\n      }\r\n    }\r\n  };\r\n  \r\n  return pc;\r\n};\r\n\r\nconst setupDataChannel = (channel, targetUserId) => {\r\n  channel.onopen = () => {\r\n    dataChannels.set(targetUserId, channel);\r\n    peerCount.value = dataChannels.size;\r\n    ElMessage.success(`与 ${targetUserId} 建立数据通道`);\r\n  };\r\n  \r\n  channel.onmessage = (event) => {\r\n    try {\r\n      const message = JSON.parse(event.data);\r\n      receivedMessages.value.push({\r\n        sender: targetUserId,\r\n        content: message.content,\r\n        timestamp: message.timestamp || Date.now()\r\n      });\r\n    } catch (error) {\r\n      // 消息解析失败\r\n    }\r\n  };\r\n  \r\n  channel.onclose = () => {\r\n    dataChannels.delete(targetUserId);\r\n    peerConnections.delete(targetUserId);\r\n    peerCount.value = dataChannels.size;\r\n    ElMessage.info(`${targetUserId} 断开连接`);\r\n  };\r\n  \r\n  channel.onerror = (error) => {\r\n    // 数据通道错误处理\r\n  };\r\n};\r\n\r\n// 处理Offer\r\nconst handleOffer = async (message) => {\r\n  const { from: targetUserId, offer } = message;\r\n  \r\n  // 检查是否已存在有效连接\r\n  if (peerConnections.has(targetUserId)) {\r\n    const existingPc = peerConnections.get(targetUserId);\r\n    if (existingPc.connectionState !== 'closed' && existingPc.connectionState !== 'failed') {\r\n      return; // 已经存在有效连接\r\n    }\r\n    // 清理旧的失效连接\r\n    existingPc.close();\r\n    peerConnections.delete(targetUserId);\r\n    dataChannels.delete(targetUserId);\r\n  }\r\n\r\n  const pc = createPeerConnection(targetUserId);\r\n  \r\n  try {\r\n    await pc.setRemoteDescription(offer);\r\n    const answer = await pc.createAnswer();\r\n    await pc.setLocalDescription(answer);\r\n\r\n    if (signalingSocket && signalingSocket.readyState === WebSocket.OPEN) {\r\n      try {\r\n        signalingSocket.send(JSON.stringify({\r\n          type: 'answer',\r\n          answer: answer,\r\n          target: targetUserId\r\n        }));\r\n      } catch (error) {\r\n        // 发送Answer失败\r\n      }\r\n    }\r\n\r\n\r\n  } catch (error) {\r\n    // 处理Offer失败\r\n  }\r\n};\r\n\r\n// 处理Answer\r\nconst handleAnswer = async (message) => {\r\n  const { from: targetUserId, answer } = message;\r\n  const pc = peerConnections.get(targetUserId);\r\n  \r\n  if (pc) {\r\n    try {\r\n      await pc.setRemoteDescription(answer);\r\n    } catch (error) {\r\n      // 处理Answer失败\r\n    }\r\n  }\r\n};\r\n\r\n// 处理ICE候选\r\nconst handleIceCandidate = async (message) => {\r\n  const { from: targetUserId, candidate } = message;\r\n  const pc = peerConnections.get(targetUserId);\r\n  \r\n  if (pc && candidate) {\r\n    try {\r\n      await pc.addIceCandidate(candidate);\r\n    } catch (error) {\r\n      // 添加ICE候选失败\r\n    }\r\n  }\r\n};\r\n\r\n// 处理用户加入\r\nconst handleUserJoined = async (message) => {\r\n  const { user: targetUserId } = message;\r\n  \r\n  if (targetUserId === connectionForm.value.userId || peerConnections.has(targetUserId)) {\r\n    return;\r\n  }\r\n\r\n  const pc = createPeerConnection(targetUserId);\r\n  \r\n  try {\r\n    // Offer方在创建Offer之前创建数据通道\r\n    const dataChannel = pc.createDataChannel('trading');\r\n    setupDataChannel(dataChannel, targetUserId);\r\n\r\n    const offer = await pc.createOffer();\r\n    await pc.setLocalDescription(offer);\r\n\r\n    if (signalingSocket && signalingSocket.readyState === WebSocket.OPEN) {\r\n      try {\r\n        signalingSocket.send(JSON.stringify({\r\n          type: 'offer',\r\n          offer: offer,\r\n          target: targetUserId\r\n        }));\r\n      } catch (error) {\r\n        // 发送Offer失败\r\n      }\r\n    }\r\n\r\n  } catch (error) {\r\n    // 创建Offer失败\r\n  }\r\n};\r\n\r\n// 清理单个Peer连接\r\nconst cleanupPeerConnection = (targetUserId) => {\r\n  const pc = peerConnections.get(targetUserId);\r\n  if (pc) {\r\n    try {\r\n      pc.close();\r\n    } catch (error) {\r\n      // 忽略关闭失败\r\n    }\r\n  }\r\n  \r\n  const channel = dataChannels.get(targetUserId);\r\n  if (channel) {\r\n    try {\r\n      channel.close();\r\n    } catch (error) {\r\n      // 忽略关闭失败\r\n    }\r\n  }\r\n  \r\n  peerConnections.delete(targetUserId);\r\n  dataChannels.delete(targetUserId);\r\n  peerCount.value = dataChannels.size;\r\n};\r\n\r\n// 处理用户离开\r\nconst handleUserLeft = (message) => {\r\n  const { user: targetUserId } = message;\r\n  \r\n  cleanupPeerConnection(targetUserId);\r\n  \r\n  ElMessage.info(`${targetUserId} 离开房间`);\r\n};\r\n\r\n// 消息处理\r\nconst sendMessage = () => {\r\n  if (!messageInput.value.trim()) return;\r\n  \r\n  const message = {\r\n    content: messageInput.value,\r\n    timestamp: Date.now(),\r\n    type: 'text'\r\n  };\r\n  \r\n  dataChannels.forEach((channel, userId) => {\r\n    if (channel.readyState === 'open') {\r\n      try {\r\n        channel.send(JSON.stringify(message));\r\n      } catch (error) {\r\n        // 发送消息失败，可能连接已关闭\r\n        cleanupPeerConnection(userId);\r\n      }\r\n    }\r\n  });\r\n  \r\n  // 添加到自己的消息列表\r\n  receivedMessages.value.push({\r\n    sender: '我',\r\n    content: messageInput.value,\r\n    timestamp: Date.now()\r\n  });\r\n  \r\n  messageInput.value = '';\r\n};\r\n\r\nconst sendTestData = () => {\r\n  const testData = {\r\n    type: 'test',\r\n    content: '这是一条测试消息',\r\n    timestamp: Date.now(),\r\n    random: Math.random()\r\n  };\r\n  \r\n  dataChannels.forEach((channel, userId) => {\r\n    if (channel.readyState === 'open') {\r\n      try {\r\n        channel.send(JSON.stringify(testData));\r\n      } catch (error) {\r\n        // 发送测试数据失败\r\n        cleanupPeerConnection(userId);\r\n      }\r\n    }\r\n  });\r\n  \r\n  ElMessage.success('测试数据已发送');\r\n};\r\n\r\n// 辅助函数\r\nconst formatTime = (timestamp) => {\r\n  return new Date(timestamp).toLocaleTimeString();\r\n};\r\n\r\n\r\n// 生命周期\r\nonMounted(() => {\r\n  // 页面加载时自动连接\r\n  connect();\r\n});\r\n\r\nonUnmounted(() => {\r\n  disconnect();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.webrtc-container {\r\n  padding: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.connection-info {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.status-panel {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-top: 20px;\r\n}\r\n\r\n.content-row {\r\n  margin-top: 20px;\r\n}\r\n\r\n.message-card {\r\n  height: 300px;\r\n}\r\n\r\n.message-actions {\r\n  margin-top: 10px;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.message-list {\r\n  height: 200px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.message-item {\r\n  padding: 8px;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.message-meta {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  font-size: 12px;\r\n  color: #666;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.message-content {\r\n  word-break: break-word;\r\n}\r\n\r\n.empty-message {\r\n  text-align: center;\r\n  color: #999;\r\n  padding: 20px;\r\n}\r\n\r\n</style>"],"names":["connectionForm","ref","messageInput","receivedMessages","connecting","isConnected","peerCount","signalingSocket","peerConnections","dataChannels","connectionStatus","computed","toggleConnection","disconnect","connect","connectToSignalingServer","ElMessage","error","peer","channel","resolve","reject","event","message","handleSignalingMessage","pc","userId","cleanupPeerConnection","handleOffer","handleAnswer","handleIceCandidate","handleUserJoined","handleUserLeft","createPeerConnection","targetUserId","config","setupDataChannel","offer","existingPc","answer","candidate","dataChannel","sendMessage","sendTestData","testData","formatTime","timestamp","onMounted","onUnmounted","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","_createElementVNode","_hoisted_2","_cache","_component_el_button","_unref","Link","_hoisted_3","_component_el_form","_component_el_form_item","_component_el_input","$event","_hoisted_4","_component_el_tag","_createTextVNode","_toDisplayString","_hoisted_5","_component_el_row","_component_el_col","_hoisted_6","_hoisted_7","_Fragment","_renderList","msg","index","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12"],"mappings":"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"}