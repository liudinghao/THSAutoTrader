import{_ as Y,j as S,i as _,r as u,o as y,f as w,d as e,w as l,b as i,I as $,h as F,F as N,m as U,a as E,e as f,t as Z,E as p,N as ee,u as P,O as te,P as ae,Q as le}from"./index-a0dcb939.js";import{a as M,b as se,s as oe}from"./concept-e5241e9d.js";import"./axios-3a665b0f.js";import"./quoteApi-6a89f341.js";const ne={class:"data-update-container"},ce={class:"section-header"},de={class:"update-content"},ue={key:0,class:"form-tip"},ie={key:1,class:"concept-selector"},re={class:"section-header"},pe={class:"update-content"},me={class:"section-header"},_e={class:"log-content"},fe={__name:"DataUpdate",setup(ye){const n=S({updateType:"full",conceptName:"",conceptIds:""}),j=S({}),V=_([]),m=_(""),x=_(!1),h=_(!1),I=_(!1),T=_(!1),L=_(!1),D=_([{timestamp:new Date().toLocaleString(),message:"系统初始化完成",type:"success"}]),s=(t,a="info")=>{D.value.unshift({timestamp:new Date().toLocaleString(),message:t,type:a})};(async()=>{try{const t=await M();V.value=t,s(`成功加载 ${t.length} 个概念`,"success")}catch(t){s(`加载概念列表失败: ${t.message}`,"danger")}})();const O=async()=>{try{x.value=!0,s(`开始更新概念个股 - 类型: ${n.updateType}`,"primary");let t=[];if(n.updateType==="full")s("正在获取所有概念代码...","info"),t=await M(!0),s(`全量更新模式，将更新 ${t.length} 个概念`,"info");else{if(!n.conceptIds.trim())throw new Error("请输入概念ID");t=n.conceptIds.split(",").map(o=>o.trim()).filter(o=>o),s(`指定更新模式，将更新 ${t.length} 个概念: ${t.join(", ")}`,"info")}let a=0,r=0,g=0;for(const o of t)try{s(`正在处理概念 ${o}...`,"info");const v=await se(o);if(v.length===0){s(`概念 ${o} 下没有股票`,"warning");continue}const d=v.map(b=>({conceptCode:o,stockCode:b}));s(`开始保存概念 ${o} 的 ${d.length} 条关系...`,"primary"),await oe(d),s(`概念 ${o} 保存成功，共 ${d.length} 条关系`,"success"),a+=d.length,r++}catch(v){s(`处理概念 ${o} 失败: ${v.message}`,"danger"),g++}const C=`概念个股更新完成: 成功处理 ${r} 个概念，失败 ${g} 个概念，共保存 ${a} 条关系`;s(C,"success"),p.success(C)}catch(t){s(`概念个股更新失败: ${t.message}`,"danger"),p.error("概念个股更新失败")}finally{x.value=!1}},Q=async()=>{try{h.value=!0,s("开始更新股票基础信息","primary"),await new Promise(t=>setTimeout(t,1500)),s("股票基础信息更新完成","success"),p.success("股票基础信息更新成功")}catch(t){s(`股票基础信息更新失败: ${t.message}`,"danger"),p.error("股票基础信息更新失败")}finally{h.value=!1}},R=async()=>{try{I.value=!0,s("开始更新行情数据","primary"),await new Promise(t=>setTimeout(t,3e3)),s("行情数据更新完成","success"),p.success("行情数据更新成功")}catch(t){s(`行情数据更新失败: ${t.message}`,"danger"),p.error("行情数据更新失败")}finally{I.value=!1}},q=async()=>{try{T.value=!0,s("开始更新财务数据","primary"),await new Promise(t=>setTimeout(t,2500)),s("财务数据更新完成","success"),p.success("财务数据更新成功")}catch(t){s(`财务数据更新失败: ${t.message}`,"danger"),p.error("财务数据更新失败")}finally{T.value=!1}},z=async()=>{try{L.value=!0,s("开始更新技术指标","primary"),await new Promise(t=>setTimeout(t,1800)),s("技术指标更新完成","success"),p.success("技术指标更新成功")}catch(t){s(`技术指标更新失败: ${t.message}`,"danger"),p.error("技术指标更新失败")}finally{L.value=!1}},A=()=>{if(m.value){const t=n.conceptIds.trim();t?t.split(",").map(r=>r.trim()).includes(m.value)||(n.conceptIds=t+","+m.value):n.conceptIds=m.value,m.value=""}},G=()=>{n.updateType="full",n.conceptName="",n.conceptIds="",m.value="",s("表单已重置","info")},H=async()=>{try{await ee.confirm("确定要清空所有日志吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),D.value=[],s("日志已清空","info")}catch{}};return(t,a)=>{const r=u("el-icon"),g=u("el-option"),C=u("el-select"),o=u("el-form-item"),v=u("el-input"),d=u("el-button"),b=u("el-form"),k=u("el-card"),B=u("el-col"),J=u("el-row"),K=u("el-timeline-item"),W=u("el-timeline");return y(),w("div",ne,[e(k,{class:"update-card"},{header:l(()=>a[3]||(a[3]=[i("div",{class:"card-header"},[i("span",null,"数据更新管理")],-1)])),default:l(()=>[e(J,{gutter:20,style:{"margin-bottom":"20px"}},{default:l(()=>[e(B,{span:12,xs:24,sm:24,md:12,lg:12,xl:12},{default:l(()=>[e(k,{class:"update-section"},{header:l(()=>[i("div",ce,[e(r,null,{default:l(()=>[e($(P))]),_:1}),a[4]||(a[4]=i("span",null,"概念个股更新",-1))])]),default:l(()=>[i("div",de,[e(b,{model:n,"label-width":"120px"},{default:l(()=>[e(o,{label:"更新类型"},{default:l(()=>[e(C,{modelValue:n.updateType,"onUpdate:modelValue":a[0]||(a[0]=c=>n.updateType=c),placeholder:"请选择更新类型",style:{width:"100%"}},{default:l(()=>[e(g,{label:"全量更新",value:"full"}),e(g,{label:"指定概念更新",value:"specific"})]),_:1},8,["modelValue"])]),_:1}),e(o,{label:"更新范围"},{default:l(()=>[e(v,{modelValue:n.conceptIds,"onUpdate:modelValue":a[1]||(a[1]=c=>n.conceptIds=c),placeholder:"请输入概念ID，多个ID用逗号分隔，如：886104,886103,886102",type:"textarea",rows:3,disabled:n.updateType==="full"},null,8,["modelValue","disabled"]),n.updateType!=="full"?(y(),w("div",ue,[e(r,null,{default:l(()=>[e($(te))]),_:1}),a[5]||(a[5]=i("span",null,"支持输入多个概念ID，用逗号分隔。留空则更新所有概念。",-1))])):F("",!0),n.updateType!=="full"?(y(),w("div",ie,[e(C,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=c=>m.value=c),placeholder:"选择概念",style:{width:"100%","margin-top":"10px"},onChange:A},{default:l(()=>[(y(!0),w(N,null,U(V.value,c=>(y(),E(g,{key:c.code,label:`${c.name} (${c.code})`,value:c.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):F("",!0)]),_:1}),e(o,null,{default:l(()=>[e(d,{type:"primary",onClick:O,loading:x.value},{default:l(()=>[e(r,null,{default:l(()=>[e($(P))]),_:1}),a[6]||(a[6]=f(" 开始更新 "))]),_:1,__:[6]},8,["loading"]),e(d,{onClick:G},{default:l(()=>a[7]||(a[7]=[f("重置")])),_:1,__:[7]})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1}),e(B,{span:12,xs:24,sm:24,md:12,lg:12,xl:12},{default:l(()=>[e(k,{class:"update-section"},{header:l(()=>[i("div",re,[e(r,null,{default:l(()=>[e($(ae))]),_:1}),a[8]||(a[8]=i("span",null,"其他数据更新",-1))])]),default:l(()=>[i("div",pe,[e(b,{model:j,"label-width":"120px"},{default:l(()=>[e(o,{label:"股票基础信息"},{default:l(()=>[e(d,{type:"success",onClick:Q,loading:h.value},{default:l(()=>a[9]||(a[9]=[f(" 更新股票信息 ")])),_:1,__:[9]},8,["loading"])]),_:1}),e(o,{label:"行情数据"},{default:l(()=>[e(d,{type:"success",onClick:R,loading:I.value},{default:l(()=>a[10]||(a[10]=[f(" 更新行情数据 ")])),_:1,__:[10]},8,["loading"])]),_:1}),e(o,{label:"财务数据"},{default:l(()=>[e(d,{type:"success",onClick:q,loading:T.value},{default:l(()=>a[11]||(a[11]=[f(" 更新财务数据 ")])),_:1,__:[11]},8,["loading"])]),_:1}),e(o,{label:"技术指标"},{default:l(()=>[e(d,{type:"success",onClick:z,loading:L.value},{default:l(()=>a[12]||(a[12]=[f(" 更新技术指标 ")])),_:1,__:[12]},8,["loading"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})]),_:1}),e(k,{class:"log-section",style:{"margin-top":"20px"}},{header:l(()=>[i("div",me,[e(r,null,{default:l(()=>[e($(le))]),_:1}),a[14]||(a[14]=i("span",null,"更新日志",-1)),e(d,{type:"text",onClick:H,style:{"margin-left":"auto"}},{default:l(()=>a[13]||(a[13]=[f(" 清空日志 ")])),_:1,__:[13]})])]),default:l(()=>[i("div",_e,[e(W,null,{default:l(()=>[(y(!0),w(N,null,U(D.value,(c,X)=>(y(),E(K,{key:X,timestamp:c.timestamp,type:c.type},{default:l(()=>[f(Z(c.message),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})])]),_:1})]),_:1})])}}},be=Y(fe,[["__scopeId","data-v-eb1bacc0"]]);export{be as default};
//# sourceMappingURL=DataUpdate-3177b663.js.map
