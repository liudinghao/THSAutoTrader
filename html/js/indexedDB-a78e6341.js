const u="THSAutoTrader";const e={ASSET_INFO:"assetInfo",POSITION_DATA:"positionData",KLINE_DATA:"klineData",ANALYSIS_RESULTS:"analysisResults"};class d{constructor(){this.db=null}async init(){return new Promise((t,o)=>{const n=indexedDB.open(u,3);n.onerror=r=>{o("数据库打开失败")},n.onsuccess=r=>{this.db=r.target.result,t()},n.onupgradeneeded=r=>{const s=r.target.result;s.objectStoreNames.contains(e.ASSET_INFO)||s.createObjectStore(e.ASSET_INFO,{keyPath:"id"}),s.objectStoreNames.contains(e.POSITION_DATA)||s.createObjectStore(e.POSITION_DATA,{keyPath:"id"}),s.objectStoreNames.contains(e.KLINE_DATA)||s.createObjectStore(e.KLINE_DATA,{keyPath:"code"}),s.objectStoreNames.contains(e.ANALYSIS_RESULTS)||s.createObjectStore(e.ANALYSIS_RESULTS,{keyPath:"stockCode"})}})}async saveData(t,o,n=1){return this.db||await this.init(),new Promise((r,s)=>{const c=this.db.transaction([t],"readwrite").objectStore(t);let A;t===e.KLINE_DATA?A={code:n,data:o,timestamp:Date.now()}:t===e.ANALYSIS_RESULTS?A={stockCode:n,...o,timestamp:Date.now()}:A={id:n,data:o,timestamp:Date.now()};const l=c.put(A);l.onsuccess=()=>r(),l.onerror=()=>s("数据保存失败")})}async getData(t,o=1){return this.db||await this.init(),new Promise((n,r)=>{const c=this.db.transaction([t],"readonly").objectStore(t).get(o);c.onsuccess=()=>n(c.result),c.onerror=()=>r("数据获取失败")})}isDataExpired(t,o=5*60*1e3){return!1}}const i=new d,I=e,T=async(a,t)=>{try{await i.saveData(e.ANALYSIS_RESULTS,t,a)}catch(o){throw console.error("保存分析结果失败:",o),o}},D=async a=>{try{return await i.getData(e.ANALYSIS_RESULTS,a)||null}catch(t){return console.error("获取分析结果失败:",t),null}},E=async()=>{try{return i.db||await i.init(),new Promise((a,t)=>{const r=i.db.transaction([e.ANALYSIS_RESULTS],"readonly").objectStore(e.ANALYSIS_RESULTS).getAll();r.onsuccess=()=>{const s={};r.result.forEach(S=>{s[S.stockCode]=S}),a(s)},r.onerror=()=>t("获取所有分析结果失败")})}catch(a){return console.error("获取所有分析结果失败:",a),{}}};export{I as S,D as a,E as g,i,T as s};
//# sourceMappingURL=indexedDB-a78e6341.js.map
