{"version":3,"file":"StockPool-116e0e69.js","sources":["../../front/src/components/StockPoolHeader.vue","../../front/src/services/stockService.js","../../front/src/views/StockPool.vue"],"sourcesContent":["<template>\r\n  <div class=\"header-buttons\">\r\n    <el-button\r\n      type=\"primary\"\r\n      size=\"small\"\r\n      :loading=\"addingToSelf\"\r\n      @click=\"handleAddAllToSelf\"\r\n    >\r\n      <el-icon class=\"el-icon--left\"><Star /></el-icon>\r\n      一键加自选\r\n    </el-button>\r\n    <el-button\r\n      :type=\"showKLine ? 'primary' : 'info'\"\r\n      size=\"small\"\r\n      @click=\"toggleKLine\"\r\n    >\r\n      <el-icon class=\"el-icon--left\"><TrendCharts /></el-icon>\r\n      {{ showKLine ? '隐藏K线' : '显示K线' }}\r\n    </el-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Star, TrendCharts } from '@element-plus/icons-vue'\r\nimport { addSelfStock } from '../utils/quoteApi'\r\n\r\nexport default {\r\n  name: 'StockPoolHeader',\r\n  components: {\r\n    Star,\r\n    TrendCharts\r\n  },\r\n  props: {\r\n    stockPool: {\r\n      type: Array,\r\n      required: true\r\n    },\r\n    showKLine: {\r\n      type: Boolean,\r\n      required: true\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      addingToSelf: false\r\n    }\r\n  },\r\n  methods: {\r\n    async handleAddAllToSelf() {\r\n      this.addingToSelf = true\r\n      try {\r\n        const stockCodes = this.stockPool.map(stock => stock.code)\r\n        await addSelfStock(stockCodes)\r\n        this.$emit('show-message', {\r\n          type: 'success',\r\n          message: '所有股票已添加到自选股'\r\n        })\r\n      } catch (error) {\r\n        console.error('添加自选股失败:', error)\r\n        this.$emit('show-message', {\r\n          type: 'error',\r\n          message: '添加自选股失败: ' + error.message\r\n        })\r\n      } finally {\r\n        this.addingToSelf = false\r\n      }\r\n    },\r\n    toggleKLine() {\r\n      this.$emit('update:showKLine', !this.showKLine)\r\n      localStorage.setItem('showKLine', !this.showKLine)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.header-buttons {\r\n  display: flex;\r\n  gap: 8px;\r\n}\r\n\r\n:deep(.el-button--small) {\r\n  padding: 4px 8px;\r\n  font-size: 12px;\r\n}\r\n</style> ","import { registerPush, unregisterPush } from '../utils/quoteApi';\r\nimport { debounce, throttle } from 'lodash-es';\r\nimport { indexedDBUtil, STORE_NAMES } from '../utils/indexedDB';\r\n\r\nexport class StockService {\r\n  constructor() {\r\n    this.quoteSessionId = null;\r\n    this.klineDataCache = new Map();\r\n    this.klineDataLoading = new Set();\r\n    this.updateQueue = new Set();\r\n    this.updateTimer = null;\r\n  }\r\n\r\n  // 从IndexedDB获取K线数据\r\n  async getKLineDataFromDB(code) {\r\n    try {\r\n      const data = await indexedDBUtil.getData(STORE_NAMES.KLINE_DATA, code);\r\n      if (data) {\r\n        // 检查数据是否过期（超过15分钟）\r\n        const now = new Date().getTime();\r\n        if (now - data.timestamp < 15 * 60 * 1000) {\r\n          return data.data;\r\n        }\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      console.error('从IndexedDB获取K线数据失败:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // 保存K线数据到IndexedDB\r\n  async saveKLineDataToDB(code, klineData) {\r\n    try {\r\n      await indexedDBUtil.saveData(STORE_NAMES.KLINE_DATA, klineData, code);\r\n    } catch (error) {\r\n      console.error('保存K线数据到IndexedDB失败:', error);\r\n    }\r\n  }\r\n\r\n  // 获取龙头股票数据\r\n  async fetchDragonStocks() {\r\n    const response = await fetch(\r\n      'https://www.wttiao.com/moni/ztpool/dragonCallback'\r\n    );\r\n    const result = await response.json();\r\n\r\n    if (result.code === 0 && result.data && Array.isArray(result.data)) {\r\n      return result.data.map((item) => ({\r\n        code: item.code,\r\n        name: item.name,\r\n        date: item.date,\r\n        zttj_days: item.zttj_days,\r\n        zttj_ct: item.zttj_ct,\r\n        reason_type: item.reason_type || '',\r\n        price: null,\r\n        change: null,\r\n      }));\r\n    }\r\n    throw new Error(result.msg || '获取数据失败');\r\n  }\r\n\r\n  // 获取K线数据\r\n  async fetchKLineData(code) {\r\n    try {\r\n      // 1. 先检查内存缓存\r\n      if (this.klineDataCache.has(code)) {\r\n        return this.klineDataCache.get(code);\r\n      }\r\n\r\n      // 2. 检查IndexedDB缓存\r\n      const dbData = await this.getKLineDataFromDB(code);\r\n      if (dbData) {\r\n        this.klineDataCache.set(code, dbData);\r\n        return dbData;\r\n      }\r\n\r\n      // 3. 从API获取新数据\r\n      const secid = code.startsWith('6') ? `1.${code}` : `0.${code}`;\r\n      const date = new Date();\r\n      const endDate = `${date.getFullYear()}${String(\r\n        date.getMonth() + 1\r\n      ).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;\r\n\r\n      const url = `https://push2his.eastmoney.com/api/qt/stock/kline/get?secid=${secid}&ut=fa5fd1943c7b386f172d6893dbfba10b&fields1=f1%2Cf2%2Cf3%2Cf4%2Cf5%2Cf6&fields2=f51%2Cf52%2Cf53%2Cf54%2Cf55%2Cf56%2Cf57%2Cf58%2Cf59%2Cf60%2Cf61&klt=101&fqt=1&end=${endDate}&lmt=30`;\r\n\r\n      const response = await fetch(url);\r\n      const result = await response.json();\r\n\r\n      if (result.rc === 0 && result.data && result.data.klines) {\r\n        const klineData = result.data.klines\r\n          .map((item) => {\r\n            const [date, open, close, high, low] = item.split(',');\r\n            return {\r\n              date,\r\n              value: [\r\n                parseFloat(open),\r\n                parseFloat(close),\r\n                parseFloat(low),\r\n                parseFloat(high),\r\n              ],\r\n            };\r\n          })\r\n          .filter(\r\n            (item) =>\r\n              !isNaN(item.value[0]) &&\r\n              !isNaN(item.value[1]) &&\r\n              !isNaN(item.value[2]) &&\r\n              !isNaN(item.value[3])\r\n          );\r\n\r\n        if (klineData.length > 0) {\r\n          // 4. 保存到内存缓存\r\n          this.klineDataCache.set(code, klineData);\r\n          // 5. 保存到IndexedDB\r\n          await this.saveKLineDataToDB(code, klineData);\r\n          return klineData;\r\n        }\r\n      }\r\n      return [];\r\n    } catch (error) {\r\n      console.error('获取K线数据失败:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // 注册行情推送\r\n  registerQuotePush(stockCodes, callback) {\r\n    if (stockCodes.length === 0) return;\r\n\r\n    if (this.quoteSessionId) {\r\n      unregisterPush(this.quoteSessionId);\r\n    }\r\n\r\n    this.quoteSessionId = registerPush(stockCodes, debounce(callback, 100));\r\n    return this.quoteSessionId;\r\n  }\r\n\r\n  // 取消行情推送\r\n  unregisterQuotePush() {\r\n    if (this.quoteSessionId) {\r\n      unregisterPush(this.quoteSessionId);\r\n      this.quoteSessionId = null;\r\n    }\r\n  }\r\n\r\n  // 加载K线数据\r\n  loadKLineData = throttle(async function (stocks, updateCallback) {\r\n    if (!stocks || !stocks.length) return;\r\n\r\n    const stockCodes = stocks.map((stock) => stock.code);\r\n\r\n    const klineDataPromises = stockCodes.map(async (code) => {\r\n      try {\r\n        const klineData = await this.fetchKLineData(code);\r\n\r\n        if (!klineData || !klineData.length) return;\r\n\r\n        const latestPrice = klineData[klineData.length - 1]?.value[1];\r\n        const prevPrice = klineData[klineData.length - 2]?.value[1];\r\n\r\n        if (latestPrice && prevPrice) {\r\n          const change = Number(\r\n            (((latestPrice - prevPrice) / prevPrice) * 100).toFixed(2)\r\n          );\r\n\r\n          updateCallback(code, {\r\n            klineData,\r\n            price: latestPrice,\r\n            change,\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(`获取股票${code}的K线数据失败:`, error);\r\n      }\r\n    });\r\n\r\n    await Promise.all(klineDataPromises);\r\n  }, 200);\r\n\r\n  // 清理资源\r\n  dispose() {\r\n    this.unregisterQuotePush();\r\n    if (this.updateTimer) {\r\n      clearTimeout(this.updateTimer);\r\n    }\r\n    this.klineDataCache.clear();\r\n    this.klineDataLoading.clear();\r\n    this.updateQueue.clear();\r\n  }\r\n}\r\n\r\nexport const stockService = new StockService();\r\n","<template>\r\n  <el-card class=\"stock-pool-card\" :body-style=\"{ padding: '20px' }\">\r\n    <template #header>\r\n      <div class=\"card-header\">\r\n        <span class=\"title\">股票池管理</span>\r\n        <stock-pool-header\r\n          :stock-pool=\"stockPool\"\r\n          :show-k-line=\"showKLine\"\r\n          @update:show-k-line=\"showKLine = $event\"\r\n          @show-message=\"$emit('show-message', $event)\"\r\n        />\r\n      </div>\r\n    </template>\r\n\r\n    <div class=\"tables-container\">\r\n      <stock-table\r\n        v-for=\"(tableData, index) in [leftTableData, rightTableData]\"\r\n        :key=\"index\"\r\n        :table-data=\"tableData\"\r\n        :loading=\"loading\"\r\n        :show-k-line=\"showKLine\"\r\n        @row-click=\"handleRowClick\"\r\n        @sort-change=\"handleSortChange\"\r\n      />\r\n    </div>\r\n  </el-card>\r\n</template>\r\n\r\n<script>\r\nimport { Delete, Trophy, Star, TrendCharts } from '@element-plus/icons-vue'\r\nimport StockTable from '../components/stock/StockTable.vue'\r\nimport StockPoolHeader from '../components/StockPoolHeader.vue'\r\nimport { jumpToQuote, addSelfStock } from '../utils/quoteApi'\r\nimport { indexedDBUtil } from '../utils/indexedDB'\r\nimport { stockService } from '../services/stockService'\r\n\r\nexport default {\r\n  name: 'StockPool',\r\n  components: {\r\n    Delete,\r\n    Trophy,\r\n    Star,\r\n    TrendCharts,\r\n    StockTable,\r\n    StockPoolHeader\r\n  },\r\n  props: {\r\n    loading: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      stockPool: [],\r\n      loadingDragonPool: false,\r\n      loadingPrices: false,\r\n      sortField: '',\r\n      sortOrder: 'desc',\r\n      addingToSelf: false,\r\n      showKLine: localStorage.getItem('showKLine') !== 'false'\r\n    }\r\n  },\r\n  created() {\r\n    this.initIndexedDB().then(() => {\r\n      this.loadDragonStockPool()\r\n      this.$nextTick(() => {\r\n        this.refreshStockPrices()\r\n      })\r\n    })\r\n  },\r\n  beforeUnmount() {\r\n    stockService.dispose()\r\n  },\r\n  computed: {\r\n    leftTableData() {\r\n      const midPoint = Math.ceil(this.sortedStockPool.length / 2)\r\n      return this.sortedStockPool.slice(0, midPoint)\r\n    },\r\n    rightTableData() {\r\n      const midPoint = Math.ceil(this.sortedStockPool.length / 2)\r\n      return this.sortedStockPool.slice(midPoint)\r\n    },\r\n    sortedStockPool() {\r\n      if (!this.sortField) {\r\n        return this.stockPool\r\n      }\r\n      \r\n      return [...this.stockPool].sort((a, b) => {\r\n        let aValue = a[this.sortField]\r\n        let bValue = b[this.sortField]\r\n        \r\n        if (aValue === null && bValue === null) return 0\r\n        if (aValue === null) return 1\r\n        if (bValue === null) return -1\r\n        \r\n        if (this.sortField === 'reason_type') {\r\n          const aFirstReason = aValue.split('+')[0]?.trim() || ''\r\n          const bFirstReason = bValue.split('+')[0]?.trim() || ''\r\n          return this.sortOrder === 'asc' \r\n            ? aFirstReason.localeCompare(bFirstReason)\r\n            : bFirstReason.localeCompare(aFirstReason)\r\n        }\r\n        \r\n        if (typeof aValue === 'number' && typeof bValue === 'number') {\r\n          return this.sortOrder === 'asc' ? aValue - bValue : bValue - aValue\r\n        }\r\n        \r\n        return this.sortOrder === 'asc' \r\n          ? String(aValue).localeCompare(String(bValue))\r\n          : String(bValue).localeCompare(String(aValue))\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    async initIndexedDB() {\r\n      try {\r\n        await indexedDBUtil.init()\r\n      } catch (error) {\r\n        console.error('初始化数据库失败:', error)\r\n        this.$emit('show-message', {\r\n          type: 'error',\r\n          message: '初始化数据库失败: ' + error.message\r\n        })\r\n      }\r\n    },\r\n    \r\n    async loadDragonStockPool() {\r\n      this.loadingDragonPool = true\r\n      \r\n      try {\r\n        const dragonStocks = await stockService.fetchDragonStocks()\r\n        await this.updateStockPool(dragonStocks)\r\n        await this.registerQuotePush()\r\n      } catch (error) {\r\n        console.error('加载龙头股票池失败:', error)\r\n        this.$emit('show-message', {\r\n          type: 'error',\r\n          message: '加载龙头股票池失败: ' + error.message\r\n        })\r\n      } finally {\r\n        this.loadingDragonPool = false\r\n      }\r\n    },\r\n\r\n    async updateStockPool(dragonStocks) {\r\n      const existingCodes = this.stockPool.map(stock => stock.code)\r\n      const newStocks = dragonStocks.filter(stock => !existingCodes.includes(stock.code))\r\n      \r\n      this.stockPool = [...this.stockPool, ...newStocks]\r\n      \r\n      this.$emit('stock-pool-updated', this.stockPool)\r\n      \r\n      this.$emit('show-message', {\r\n        type: 'success',\r\n        message: `成功加载${newStocks.length}只龙头股票到股票池`\r\n      })\r\n\r\n      stockService.loadKLineData(newStocks, (code, data) => {\r\n        const stockIndex = this.stockPool.findIndex(s => s.code === code)\r\n        if (stockIndex !== -1) {\r\n          Object.assign(this.stockPool[stockIndex], data)\r\n        }\r\n      })\r\n    },\r\n\r\n    async registerQuotePush() {\r\n      const stockCodes = this.stockPool.map(stock => stock.code)\r\n      stockService.registerQuotePush(stockCodes, (data) => {\r\n        data.forEach(item => {\r\n          const stock = this.stockPool.find(s => s.code === item.code)\r\n          if (stock) {\r\n            const updates = {}\r\n            if (item.price !== undefined && item.price !== null) {\r\n              updates.price = item.price\r\n            }\r\n            if (item.zhangdiefu !== undefined && item.zhangdiefu !== null) {\r\n              updates.change = item.zhangdiefu\r\n            }\r\n\r\n            \r\n            if (Object.keys(updates).length > 0) {\r\n              Object.assign(stock, updates)\r\n            }\r\n          }\r\n        })\r\n      })\r\n    },\r\n\r\n    async refreshStockPrices() {\r\n      if (this.stockPool.length === 0) {\r\n        this.$emit('show-message', {\r\n          type: 'warning',\r\n          message: '股票池为空，无需刷新'\r\n        })\r\n        return\r\n      }\r\n      \r\n      this.loadingPrices = true\r\n      \r\n      try {\r\n        const stockCodes = this.stockPool.map(stock => stock.code)\r\n        stockService.registerQuotePush(stockCodes, this.handleQuoteData)\r\n        \r\n        this.$emit('show-message', {\r\n          type: 'success',\r\n          message: '股票价格推送注册成功'\r\n        })\r\n      } catch (error) {\r\n        console.error('刷新股票价格失败:', error)\r\n        this.$emit('show-message', {\r\n          type: 'error',\r\n          message: '刷新股票价格失败: ' + error.message\r\n        })\r\n      } finally {\r\n        this.loadingPrices = false\r\n      }\r\n    },\r\n    \r\n    handleRowClick(row) {\r\n      const stockCodes = this.stockPool.map(stock => stock.code)\r\n      jumpToQuote(row.code, stockCodes)\r\n    },\r\n\r\n    handleSortChange({ prop, order }) {\r\n      if (!prop) {\r\n        this.sortField = ''\r\n        this.sortOrder = 'desc'\r\n        return\r\n      }\r\n      \r\n      this.sortField = prop\r\n      this.sortOrder = order === 'ascending' ? 'asc' : 'desc'\r\n      \r\n      this.$nextTick(() => {\r\n        this.stockPool = [...this.sortedStockPool]\r\n      })\r\n    },\r\n\r\n    async handleAddAllToSelf() {\r\n      this.addingToSelf = true\r\n      try {\r\n        const stockCodes = this.stockPool.map(stock => stock.code)\r\n        await addSelfStock(stockCodes)\r\n        this.$emit('show-message', {\r\n          type: 'success',\r\n          message: '所有股票已添加到自选股'\r\n        })\r\n      } catch (error) {\r\n        console.error('添加自选股失败:', error)\r\n        this.$emit('show-message', {\r\n          type: 'error',\r\n          message: '添加自选股失败: ' + error.message\r\n        })\r\n      } finally {\r\n        this.addingToSelf = false\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.title {\r\n  font-size: var(--font-size-xlarge);\r\n  font-weight: 600;\r\n}\r\n\r\n.tables-container {\r\n  display: grid;\r\n  grid-template-columns: 1fr 1fr;\r\n  gap: var(--spacing-small);\r\n}\r\n\r\n/* 表格样式优化 */\r\n:deep(.el-card__header) {\r\n  padding: var(--spacing-small) var(--spacing-base);\r\n}\r\n\r\n:deep(.el-table) {\r\n  width: 100% !important;\r\n}\r\n\r\n:deep(.el-table__body),\r\n:deep(.el-table__header) {\r\n  width: 100% !important;\r\n}\r\n\r\n:deep(.el-table__body-wrapper) {\r\n  overflow-x: auto;\r\n}\r\n\r\n:deep(.el-table__row) { \r\n  height: 30px;\r\n}\r\n\r\n:deep(.el-table .cell) {\r\n  padding: 1px var(--spacing-mini);  \r\n}\r\n\r\n:deep(.el-table__header .cell) {\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.el-table__body td) {\r\n  padding: 0;\r\n}\r\n\r\n:deep(.el-button--small) {\r\n  padding: var(--spacing-mini) var(--spacing-small);\r\n  font-size: var(--font-size-small);\r\n}\r\n\r\n:deep(.el-tag--small) {\r\n  padding: 0 var(--spacing-mini);\r\n  height: 20px;\r\n  line-height: 18px;\r\n}\r\n\r\n/* 标签基础样式 */\r\n:deep(.el-tag) {\r\n  --tag-bg: var(--tag-info-bg);\r\n  --tag-border: var(--tag-info-border);\r\n  --tag-color: var(--tag-info-color);\r\n  \r\n  background-color: var(--tag-bg);\r\n  border-color: var(--tag-border);\r\n  color: var(--tag-color);\r\n}\r\n\r\n/* 标签变体样式 */\r\n:deep(.el-tag--success) {\r\n  --tag-bg: var(--tag-success-bg);\r\n  --tag-border: var(--tag-success-border);\r\n  --tag-color: var(--tag-success-color);\r\n}\r\n\r\n:deep(.el-tag--warning) {\r\n  --tag-bg: var(--tag-warning-bg);\r\n  --tag-border: var(--tag-warning-border);\r\n  --tag-color: var(--tag-warning-color);\r\n}\r\n\r\n:deep(.el-tag--danger) {\r\n  --tag-bg: var(--tag-danger-bg);\r\n  --tag-border: var(--tag-danger-border);\r\n  --tag-color: var(--tag-danger-color);\r\n}\r\n\r\n:deep(.el-tag--info) {\r\n  --tag-bg: var(--tag-info-bg);\r\n  --tag-border: var(--tag-info-border);\r\n  --tag-color: var(--tag-info-color);\r\n}\r\n\r\n:deep(.el-tag--primary) {\r\n  --tag-bg: var(--tag-primary-bg);\r\n  --tag-border: var(--tag-primary-border);\r\n  --tag-color: var(--tag-primary-color);\r\n}\r\n</style>"],"names":["_sfc_main","Star","TrendCharts","stockCodes","stock","addSelfStock","error","_hoisted_1","_openBlock","_createElementBlock","_createVNode","_component_el_button","$data","$options","_component_el_icon","_component_Star","$props","_component_TrendCharts","_createTextVNode","StockService","__publicField","throttle","stocks","updateCallback","klineDataPromises","code","klineData","latestPrice","_a","prevPrice","_b","change","data","indexedDBUtil","STORE_NAMES","result","item","dbData","secid","date","endDate","url","open","close","high","low","callback","unregisterPush","registerPush","debounce","stockService","Delete","Trophy","StockTable","StockPoolHeader","midPoint","a","b","aValue","bValue","aFirstReason","bFirstReason","dragonStocks","existingCodes","newStocks","stockIndex","s","updates","row","jumpToQuote","prop","order","_hoisted_2","_createBlock","_component_el_card","_createElementVNode","_cache","_component_stock_pool_header","$event","_ctx","_Fragment","tableData","index","_component_stock_table"],"mappings":"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"}