function F(t,r="HH:mm:00"){const n=new Date(parseInt(t)*1e3),o=n.getHours().toString().padStart(2,"0"),e=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0");return r.replace("HH",o).replace("mm",e).replace("ss",a)}function C(t){return F(t,"HH:mm:00")}function k(t,r){API.use({method:"Quote.syncStockList",data:{id:379,code:t,period:"8192",stocklist:r.join("|")},success:function(n){}})}function L(t,r){var n=window.API.createSessionId("Quote");return console.log("quoteSessionId:",n),window.API.use({method:"Quote.registerPush",data:{code:t.join(",")},sessionId:n,persistent:!0,callbackName:"onready",success:function(o){window.API.use({method:"Quote.getData2",data:{code:t.join(","),type:["NEW","ZHANGDIEFU","ZHANGSHU"],period:"now",mode:"after"},success:function(e){const a=JSON.parse(e);console.log("registerPush:",e),r(a)}})}}),n}function b(t){window.API.use({method:"Quote.unregisterPush",sessionId:t,success:function(r){t=null,customLog("取消监听成功")}})}function R(t){return new Promise((r,n)=>{window.API.use({method:"Quote.setSelfStock",data:{mode:"add",code:t.join(",")},success:function(o){r(o)},error:function(o){n(o)}})})}function V(t){return new Promise((r,n)=>{window.API.use({method:"Util.getBlockStockByCode",data:t,success:function(o){try{const e=o.split(",").filter(a=>a.trim());console.log(`概念 ${t} 获取到 ${e.length} 只股票:`,e),r(e)}catch(e){n(new Error(`解析股票代码失败: ${e.message}`))}},error:function(o){n(new Error(`获取概念股票失败: ${o.message}`))}})})}async function T(t,r=null){return new Promise(async(n,o)=>{try{const e=r||await y(),a={};try{const c=await D(t,e,e);for(const[i,s]of Object.entries(c))s&&s[e]&&s[e].PRE&&(a[i]=parseFloat(s[e].PRE))}catch(c){console.warn("获取昨收价失败，将使用默认值:",c,t,e)}window.API.use({method:"Quote.request",data:{code:t,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",begin:e,withmarket:!1,end:e,timeFmt:1},success:c=>{window.API.use({method:"Quote.getData2",data:{code:t,withmarket:!1,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",timeStamp:1,updateMode:1,time:{begin:e,end:e,timeFmt:1}},success:i=>{try{const s=JSON.parse(i);console.log("fetchMinuteData: 获取分时原始数据完成",s);const d={};for(const[l,u]of Object.entries(s)){const h={},P=Object.entries(u);P.forEach(([N,m],f)=>{let p=parseFloat(m.VOL||0);if(f>0){const g=P[f-1][1],A=parseFloat(g.VOL||0);p=Math.max(0,p-A)}let I=parseFloat(m.money||0);if(f>0){const g=P[f-1][1],A=parseFloat(g.money||0);I=Math.max(0,I-A)}const O=C(N),H=parseFloat(m.NEW||m.JUNJIA||0),w=a[l];let E=0;w&&w>0&&(E=(H-w)/w*100),h[O]={...m,VOL:p.toString(),money:I.toString(),changePercent:parseFloat(E.toFixed(2)),preClose:w||null}}),d[l]=h}n(d)}catch(s){console.error("解析分时数据失败:",s),o(s)}},error:i=>{console.error("获取分时详细数据失败:",i),o(i)},notClient:()=>{console.error("API客户端不可用"),o(new Error("API客户端不可用"))}})},error:c=>{console.error("请求分时数据失败:",c),o(c)},notClient:()=>{console.error("API客户端不可用"),o(new Error("API客户端不可用"))}})}catch(e){console.error("fetchMinuteData 执行失败:",e),o(e)}})}async function Q(t){return new Promise((r,n)=>{window.API.use({method:"Quote.request",data:{code:t,type:["NEW","ZHANGDIEFU","OPEN"],period:"now"},callbackName:"onready",success:o=>{window.API.use({method:"Quote.getData2",data:{code:t,type:["NEW","ZHANGDIEFU","OPEN"],period:"now",mode:"after"},success:e=>{try{const a=JSON.parse(e),c={};for(const[i,s]of Object.entries(a)){const d=parseFloat(s.NEW),l=parseFloat(s.ZHANGDIEFU);let u=null;!isNaN(d)&&!isNaN(l)&&(u=d/(1+l/100),u=parseFloat(u.toFixed(4))),c[i]={NEW:s.NEW,PRE:u?u.toString():null,ZHANGDIEFU:s.ZHANGDIEFU,OPEN:s.OPEN}}r(c)}catch(a){console.error("解析实时行情数据失败:",a),n(a)}},error:e=>{console.error("获取实时行情详细数据失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})},error:o=>{console.error("请求实时行情数据失败:",o,t),n(o)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}async function D(t,r,n){return new Promise((o,e)=>{const a=Array.isArray(t)?t:[t];window.API.use({method:"Quote.request",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",begin:r,end:n},success:function(c){window.API.use({method:"Quote.getData2",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",mode:"after",time:{begin:r,end:n,timeFmt:1},updateMode:1},success:function(i){try{const s=JSON.parse(i);o(s)}catch(s){console.error("解析历史数据失败:",s),e(s)}},error:function(i){console.error("获取历史详细数据失败:",i),e(i)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})},error:function(c){console.error("请求历史数据失败:",c),e(c)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})})}function y(t=null){return new Promise((r,n)=>{const o=t||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getSHTradeDate",data:o,success:function(e){r(e)},error:function(e){console.error("获取最近交易日失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function G(t=null){return new Promise((r,n)=>{const o=t||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getPreSHTradeDate",data:o,success:function(e){r(e)},error:function(e){console.error("获取最近交易日失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function M(t="300033"){return new Promise((r,n)=>{window.API.use({method:"Quote.isTradeTime",data:t,success:function(o){console.log("是否在交易时间内:",o),r(o)},error:function(o){console.error("检查交易时间失败:",o),n(o)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function S(t=1){return new Promise((r,n)=>{window.API.use({method:"Util.getAllBlockCode",data:{needMarket:t},success:function(o){try{const a=o.split(",").filter(c=>c.trim()).map(c=>{const[i,s]=c.split(":");return{code:s||"",marketId:i||""}});r(a)}catch(e){n(new Error(`解析股票代码失败: ${e.message}`))}},error:function(o){console.error("获取板块代码失败:",o),n(o)},notClient:function(){console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function U(t,r,n="",o=""){return new Promise((e,a)=>{const c=`<?xml version="1.0" encoding="GB2312"?><RealTime StockCode="${r}" Market="33"><Bid><Price Selected="1">${n}</Price><Amount>${o}</Amount></Bid></RealTime>`,i=`wt_startup=wt_startup=\r
realtime=`+window.btoa(unescape(encodeURIComponent(c)));window.API.use({method:"XdMgr.fastCallXiadan",data:{cmd:t===0?"XD_MAIRU":"XD_MAICHU",code:r,amount:o,info:i,default:!1,hide:!1,select:!0},success:function(s){console.log(`${t===0?"买入":"卖出"}下单成功:`,r,s),e(s)},error:function(s){console.error(`${t===0?"买入":"卖出"}下单失败:`,r,s),a(s)},notClient:function(){const s="API客户端不可用";console.error(s),a(new Error(s))}})})}function J(){const t=new Date,r=t.getHours(),n=t.getMinutes(),o=r*100+n;return o>=915&&o<925||o>=930&&o<1130||o>=1300&&o<1500}window.getAllStockCodes=S;window.getAllBlockCode=S;window.placeOrder=U;window.getLatestTradeDate=y;window.fetchMinuteData=T;window.fetchRealTimeQuote=Q;window.fetchHistoryData=D;window.isTradeTime=M;export{T as a,S as b,Q as c,y as d,J as e,D as f,G as g,R as h,M as i,k as j,V as k,L as r,b as u};
//# sourceMappingURL=quoteApi-88d43989.js.map
