{"version":3,"file":"AssetManagement-24e97328.js","sources":["../../front/src/views/AssetManagement.vue"],"sourcesContent":["<template>\r\n  <div class=\"asset-management\">\r\n    <!-- 资产信息卡片 -->\r\n    <el-card class=\"asset-info-card\" :body-style=\"{ padding: '20px' }\" v-loading=\"loading.asset\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>资产信息</span>\r\n          <el-button type=\"primary\" :icon=\"Refresh\" circle @click=\"refreshAssetInfo\" :loading=\"loading.asset\" />\r\n        </div>\r\n      </template>\r\n      <div class=\"asset-info-grid\">\r\n        <div v-for=\"(value, key) in assetInfo\" :key=\"key\" class=\"asset-info-item\">\r\n          <span class=\"label\">{{ key }}：</span>\r\n          <span class=\"value\" :class=\"getValueClass(key, value)\">{{ value }}</span>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 持仓信息表格 -->\r\n    <el-card class=\"position-card\" :body-style=\"{ padding: '20px' }\" v-loading=\"loading.position\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>当前持仓</span>\r\n          <el-button type=\"primary\" :icon=\"Refresh\" circle @click=\"refreshPositionData\" :loading=\"loading.position\" />\r\n        </div>\r\n      </template>\r\n      <el-table :data=\"positionData\" style=\"width: 100%\" border stripe>\r\n        <el-table-column prop=\"序号\" label=\"序号\" min-width=\"50\" />\r\n        <el-table-column prop=\"证券代码\" label=\"证券代码\" min-width=\"80\" />\r\n        <el-table-column prop=\"证券名称\" label=\"证券名称\" min-width=\"80\" />\r\n        <el-table-column prop=\"股票余额\" label=\"股票余额\" min-width=\"80\" />\r\n        <el-table-column prop=\"可用余额\" label=\"可用余额\" min-width=\"80\" />\r\n        <el-table-column prop=\"成本价\" label=\"成本价\" min-width=\"80\" />\r\n        <el-table-column prop=\"市价\" label=\"市价\" min-width=\"80\" />\r\n        <el-table-column prop=\"盈亏\" label=\"盈亏\" min-width=\"80\">\r\n          <template #default=\"scope\">\r\n            <span :class=\"getValueClass('盈亏', scope.row.盈亏)\">{{ scope.row.盈亏 }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"盈亏比例(%)\" label=\"盈亏比例(%)\" min-width=\"90\">\r\n          <template #default=\"scope\">\r\n            <span :class=\"getValueClass('盈亏比例', scope.row['盈亏比例(%)'])\">{{ scope.row['盈亏比例(%)'] }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"当日盈亏\" label=\"当日盈亏\" min-width=\"80\">\r\n          <template #default=\"scope\">\r\n            <span :class=\"getValueClass('当日盈亏', scope.row.当日盈亏)\">{{ scope.row.当日盈亏 }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"当日盈亏比(%)\" label=\"当日盈亏比(%)\" min-width=\"90\">\r\n          <template #default=\"scope\">\r\n            <span :class=\"getValueClass('当日盈亏比', scope.row['当日盈亏比(%)'])\">{{ scope.row['当日盈亏比(%)'] }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"市值\" label=\"市值\" min-width=\"80\" />\r\n        <el-table-column prop=\"仓位占比(%)\" label=\"仓位占比(%)\" min-width=\"90\" />\r\n        <el-table-column prop=\"交易市场\" label=\"交易市场\" min-width=\"80\" />\r\n      </el-table>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { Refresh } from '@element-plus/icons-vue'\r\nimport { indexedDBUtil } from '../utils/indexedDB'\r\nimport { getAssetInfo, getPositionData } from '../api/asset'\r\n\r\nconst loading = ref({\r\n  asset: false,\r\n  position: false\r\n})\r\nconst assetInfo = ref({})\r\nconst positionData = ref([])\r\n\r\n// 初始化 IndexedDB\r\nconst initDB = async () => {\r\n  try {\r\n    console.log('开始初始化 IndexedDB...')\r\n    await indexedDBUtil.init()\r\n    console.log('IndexedDB 初始化成功')\r\n  } catch (error) {\r\n    console.error('初始化数据库失败:', error)\r\n    ElMessage.error('初始化数据库失败')\r\n  }\r\n}\r\n\r\n// 获取资产信息\r\nconst fetchAssetInfo = async (forceRefresh = false) => {\r\n  if (loading.value.asset) return\r\n  \r\n  loading.value.asset = true\r\n  try {\r\n    const data = await getAssetInfo(forceRefresh)\r\n    assetInfo.value = data\r\n  } catch (error) {\r\n    console.error('获取资产信息失败:', error)\r\n    ElMessage.error(`获取资产信息失败: ${error.message}`)\r\n  } finally {\r\n    loading.value.asset = false\r\n  }\r\n}\r\n\r\n// 获取持仓信息\r\nconst fetchPositionData = async (forceRefresh = false) => {\r\n  if (loading.value.position) return\r\n  \r\n  loading.value.position = true\r\n  try {\r\n    const data = await getPositionData(forceRefresh)\r\n    positionData.value = data\r\n  } catch (error) {\r\n    console.error('获取持仓信息失败:', error)\r\n    ElMessage.error(`获取持仓信息失败: ${error.message}`)\r\n  } finally {\r\n    loading.value.position = false\r\n  }\r\n}\r\n\r\n// 刷新资产信息\r\nconst refreshAssetInfo = () => {\r\n  fetchAssetInfo(true)\r\n}\r\n\r\n// 刷新持仓信息\r\nconst refreshPositionData = () => {\r\n  fetchPositionData(true)\r\n}\r\n\r\n// 页面加载时获取数据\r\nonMounted(async () => {\r\n  try {\r\n    await initDB()\r\n    await Promise.all([fetchAssetInfo(), fetchPositionData()])\r\n  } catch (error) {\r\n    console.error('数据加载失败:', error)\r\n    ElMessage.error('数据加载失败')\r\n  }\r\n})\r\n\r\n// 根据数值判断显示颜色\r\nconst getValueClass = (key, value) => {\r\n  if (typeof value === 'string') {\r\n    const numValue = parseFloat(value.replace(/[^0-9.-]/g, ''))\r\n    if (key.includes('盈亏') || key.includes('盈亏比')) {\r\n      return numValue > 0 ? 'text-red' : numValue < 0 ? 'text-green' : ''\r\n    }\r\n  }\r\n  return ''\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.asset-management {\r\n  padding: 20px;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.asset-info-card {\r\n  margin-bottom: 20px;\r\n  width: 100%;\r\n}\r\n\r\n.asset-info-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\r\n  gap: 20px;\r\n}\r\n\r\n.asset-info-item {\r\n  display: flex;\r\n  align-items: center;\r\n  min-width: 0;\r\n}\r\n\r\n.asset-info-item .label {\r\n  font-weight: bold;\r\n  margin-right: 8px;\r\n  white-space: nowrap;\r\n}\r\n\r\n.asset-info-item .value {\r\n  flex: 1;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n.text-red {\r\n  color: #f56c6c;\r\n}\r\n\r\n.text-green {\r\n  color: #67c23a;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.position-card {\r\n  width: 100%;\r\n}\r\n\r\n.position-card :deep(.el-table) {\r\n  width: 100% !important;\r\n}\r\n\r\n.position-card :deep(.el-table__body-wrapper) {\r\n  overflow-x: auto;\r\n}\r\n\r\n@media screen and (max-width: 768px) {\r\n  .asset-info-grid {\r\n    grid-template-columns: 1fr;\r\n  }\r\n  \r\n  .asset-management {\r\n    padding: 10px;\r\n  }\r\n}\r\n</style> "],"names":["loading","ref","assetInfo","positionData","initDB","indexedDBUtil","error","ElMessage","fetchAssetInfo","forceRefresh","data","getAssetInfo","fetchPositionData","getPositionData","refreshAssetInfo","refreshPositionData","onMounted","getValueClass","key","value","numValue","_openBlock","_createElementBlock","_hoisted_1","_createBlock","_component_el_card","_createElementVNode","_hoisted_2","_cache","_createVNode","_component_el_button","_unref","Refresh","_hoisted_3","_Fragment","_renderList","_hoisted_4","_toDisplayString","_directive_loading","_hoisted_5","_component_el_table","_component_el_table_column","_withCtx","scope","_normalizeClass"],"mappings":"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"}