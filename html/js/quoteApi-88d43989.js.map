{"version":3,"file":"quoteApi-88d43989.js","sources":["../../front/src/utils/quoteApi.js"],"sourcesContent":["/**\r\n * 股票行情相关 API\r\n */\r\n\r\n/**\r\n * 时间戳转换工具函数\r\n * @param {number|string} timestamp 时间戳（秒）\r\n * @param {string} format 输出格式，默认为 'HH:mm:00'\r\n * @returns {string} 格式化后的时间字符串\r\n */\r\nexport function formatTimestamp(timestamp, format = 'HH:mm:00') {\r\n  const date = new Date(parseInt(timestamp) * 1000);\r\n  const hours = date.getHours().toString().padStart(2, '0');\r\n  const minutes = date.getMinutes().toString().padStart(2, '0');\r\n  const seconds = date.getSeconds().toString().padStart(2, '0');\r\n\r\n  return format\r\n    .replace('HH', hours)\r\n    .replace('mm', minutes)\r\n    .replace('ss', seconds);\r\n}\r\n\r\n/**\r\n * 将时间戳转换为 HH:mm:00 格式（与时间轴格式保持一致）\r\n * @param {number|string} timestamp 时间戳（秒）\r\n * @returns {string} 格式化的时间字符串，如 \"14:30:00\"\r\n */\r\nexport function timestampToTimeString(timestamp) {\r\n  return formatTimestamp(timestamp, 'HH:mm:00');\r\n}\r\n\r\n/**\r\n * 将时间戳转换为完整的日期时间格式\r\n * @param {number|string} timestamp 时间戳（秒）\r\n * @returns {string} 格式化的时间字符串，如 \"2024-01-01 14:30:00\"\r\n */\r\nexport function timestampToDateTime(timestamp) {\r\n  const date = new Date(parseInt(timestamp) * 1000);\r\n  return date\r\n    .toLocaleString('zh-CN', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit',\r\n      hour12: false,\r\n    })\r\n    .replace(/\\//g, '-');\r\n}\r\n\r\n/**\r\n * 跳转到分时图\r\n * @param {string} code 代码\r\n * @param {string[]} stockCode 跟踪代码数组\r\n */\r\nexport function jumpToQuote(code, stockCode) {\r\n  API.use({\r\n    method: 'Quote.syncStockList',\r\n    data: {\r\n      id: 379, // 379为分时图，65为k线\r\n      code: code,\r\n      period: '8192',\r\n      stocklist: stockCode.join('|'),\r\n    },\r\n    success: function (result) {},\r\n  });\r\n}\r\n\r\n/**\r\n * 注册推送\r\n * @param {string[]} codes 股票代码数组\r\n * @param {Function} callback 回调函数\r\n * @returns {string} quoteSessionId 会话ID\r\n */\r\nexport function registerPush(codes, callback) {\r\n  var quoteSessionId = window.API.createSessionId('Quote');\r\n  console.log('quoteSessionId:', quoteSessionId);\r\n  window.API.use({\r\n    method: 'Quote.registerPush',\r\n    data: { code: codes.join(',') },\r\n    sessionId: quoteSessionId,\r\n    persistent: true,\r\n    callbackName: 'onready',\r\n    success: function (data) {\r\n      window.API.use({\r\n        method: 'Quote.getData2',\r\n        data: {\r\n          code: codes.join(','),\r\n          type: ['NEW', 'ZHANGDIEFU', 'ZHANGSHU'],\r\n          period: 'now',\r\n          mode: 'after',\r\n        },\r\n        success: function (data) {\r\n          const stockData = JSON.parse(data);\r\n          console.log('registerPush:', data);\r\n          callback(stockData);\r\n        },\r\n      });\r\n    },\r\n  });\r\n  return quoteSessionId;\r\n}\r\n\r\n/**\r\n * 取消推送\r\n * @param {string} sessionId 会话ID\r\n */\r\nexport function unregisterPush(sessionId) {\r\n  window.API.use({\r\n    method: 'Quote.unregisterPush',\r\n    sessionId: sessionId,\r\n    success: function (data) {\r\n      sessionId = null;\r\n      // 通知\r\n      customLog('取消监听成功');\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * 获取自选股列表\r\n * @returns {Promise} 返回自选股列表的Promise\r\n */\r\nexport function getSelfStocks() {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Passport.selfStocks',\r\n      success: function (stocklist) {\r\n        resolve(stocklist);\r\n      },\r\n      error: function (error) {\r\n        reject(error);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 添加自选股\r\n * @param {string[]} code 股票代码\r\n * @returns {Promise} 返回操作结果的Promise\r\n */\r\nexport function addSelfStock(code) {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Quote.setSelfStock',\r\n      data: {\r\n        mode: 'add',\r\n        code: code.join(','),\r\n      },\r\n      success: function (result) {\r\n        resolve(result);\r\n      },\r\n      error: function (error) {\r\n        reject(error);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 删除自选股\r\n * @param {string[]} code 股票代码\r\n * @returns {Promise} 返回操作结果的Promise\r\n */\r\nexport function removeSelfStock(code) {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Quote.setSelfStock',\r\n      data: {\r\n        mode: 'del',\r\n        code: code.join(','),\r\n      },\r\n      success: function (result) {\r\n        resolve(result);\r\n      },\r\n      error: function (error) {\r\n        reject(error);\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 根据概念代码获取股票列表\r\n * @param {string} conceptCode 概念代码\r\n * @returns {Promise<string[]>} 返回股票代码数组的Promise\r\n */\r\nexport function getStocksByConceptCode(conceptCode) {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Util.getBlockStockByCode',\r\n      data: conceptCode,\r\n      success: function (result) {\r\n        try {\r\n          // 返回的是逗号分隔的股票代码字符串，需要转换为数组\r\n          const stockCodes = result.split(',').filter((code) => code.trim());\r\n          console.log(\r\n            `概念 ${conceptCode} 获取到 ${stockCodes.length} 只股票:`,\r\n            stockCodes\r\n          );\r\n          resolve(stockCodes);\r\n        } catch (error) {\r\n          reject(new Error(`解析股票代码失败: ${error.message}`));\r\n        }\r\n      },\r\n      error: function (error) {\r\n        reject(new Error(`获取概念股票失败: ${error.message}`));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/*\r\n * 获取股票分时数据\r\n * 返回的数据结构为：\r\n * {\r\n * \"177:HK0700\": {\r\n *   \"09:30:00\": {\r\n *     JUNJIA: \"1.4090\",\r\n *     NEW: \"1.4090\",\r\n *     VOL: \"17104500.000\",\r\n *     money: \"24100241.000\",\r\n *     changePercent: 2.5,  // 新增：涨跌幅百分比\r\n *     preClose: 1.3750     // 新增：昨收价\r\n *   }\r\n *   \"09:31:00\": {\r\n *     JUNJIA: \"1.4118\",\r\n *     NEW: \"1.4170\",\r\n *     VOL: \"108021700.000\",\r\n *     money: \"152508600.000\",\r\n *     changePercent: 3.05, // 新增：涨跌幅百分比\r\n *     preClose: 1.3750     // 新增：昨收价\r\n *   }\r\n * }\r\n * }\r\n * 注意：\r\n * 1. 时间键已转换为 HH:mm:00 格式，无需再次转换\r\n * 2. VOL 和 money 字段已经过处理，第一个数据点的成交量和成交额保持不变，后续数据点的成交量和成交额已计算为增量值\r\n * 3. 新增 changePercent 字段：涨跌幅百分比，保留2位小数\r\n * 4. 新增 preClose 字段：昨收价，用于计算涨跌幅\r\n */\r\nexport async function fetchMinuteData(stockCodes, date = null) {\r\n  return new Promise(async (resolve, reject) => {\r\n    try {\r\n      // 如果没有指定日期，使用最近交易日\r\n      const targetDate = date || await getLatestTradeDate();\r\n      // 首先获取昨收价\r\n      const preCloseData = {};\r\n      try {\r\n        const historyData = await fetchHistoryData(\r\n          stockCodes,\r\n          targetDate,\r\n          targetDate\r\n        );\r\n        for (const [stockCode, stockData] of Object.entries(historyData)) {\r\n          if (stockData && stockData[targetDate] && stockData[targetDate].PRE) {\r\n            preCloseData[stockCode] = parseFloat(stockData[targetDate].PRE);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.warn('获取昨收价失败，将使用默认值:', error, stockCodes, targetDate);\r\n      }\r\n\r\n      // 第一步：请求分时数据\r\n      window.API.use({\r\n        method: 'Quote.request',\r\n        data: {\r\n          code: stockCodes,\r\n          type: ['NEW', 'VOL', 'JUNJIA', 'money', 'ZHANGDIEFU'],\r\n          period: 'min',\r\n          begin: targetDate,\r\n          withmarket: false,\r\n          end: targetDate,\r\n          timeFmt: 1,\r\n        },\r\n        success: (data) => {\r\n          // 第二步：获取详细数据\r\n          window.API.use({\r\n            method: 'Quote.getData2',\r\n            data: {\r\n              code: stockCodes,\r\n              withmarket: false,\r\n              type: ['NEW', 'VOL', 'JUNJIA', 'money', 'ZHANGDIEFU'],\r\n              period: 'min',\r\n              timeStamp: 1,\r\n              updateMode: 1,\r\n              time: {\r\n                begin: targetDate,\r\n                end: targetDate,\r\n                timeFmt: 1,\r\n              },\r\n            },\r\n            success: (data) => {\r\n              try {\r\n                const parsedData = JSON.parse(data);\r\n                console.log(\r\n                  'fetchMinuteData: 获取分时原始数据完成',\r\n                  parsedData\r\n                );\r\n\r\n                // 处理成交量计算\r\n                const processedData = {};\r\n                for (const [stockCode, timeData] of Object.entries(\r\n                  parsedData\r\n                )) {\r\n                  const processedTimeData = {};\r\n                  const entries = Object.entries(timeData);\r\n                  entries.forEach(([timestamp, values], index) => {\r\n                    // 计算成交量：第一个数据保持不变，后续数据等于当前数据减去上一个数据\r\n                    let calculatedVol = parseFloat(values.VOL || 0);\r\n                    if (index > 0) {\r\n                      const prevValues = entries[index - 1][1];\r\n                      const prevVol = parseFloat(prevValues.VOL || 0);\r\n                      calculatedVol = Math.max(0, calculatedVol - prevVol); // 确保不为负数\r\n                    }\r\n\r\n                    // 计算成交额：第一个数据保持不变，后续数据等于当前数据减去上一个数据\r\n                    let calculatedMoney = parseFloat(values.money || 0);\r\n                    if (index > 0) {\r\n                      const prevValues = entries[index - 1][1];\r\n                      const prevMoney = parseFloat(prevValues.money || 0);\r\n                      calculatedMoney = Math.max(\r\n                        0,\r\n                        calculatedMoney - prevMoney\r\n                      ); // 确保不为负数\r\n                    }\r\n\r\n                    // 直接转换时间戳为时间字符串\r\n                    const timeStr = timestampToTimeString(timestamp);\r\n\r\n                    // 计算涨跌幅\r\n                    const currentPrice = parseFloat(\r\n                      values.NEW || values.JUNJIA || 0\r\n                    );\r\n                    const preClose = preCloseData[stockCode];\r\n                    let changePercent = 0;\r\n                    if (preClose && preClose > 0) {\r\n                      changePercent =\r\n                        ((currentPrice - preClose) / preClose) * 100;\r\n                    }\r\n\r\n                    processedTimeData[timeStr] = {\r\n                      ...values,\r\n                      VOL: calculatedVol.toString(), // 使用计算后的成交量\r\n                      money: calculatedMoney.toString(), // 使用计算后的成交额\r\n                      changePercent: parseFloat(changePercent.toFixed(2)), // 涨跌幅百分比，保留2位小数\r\n                      preClose: preClose || null, // 昨收价\r\n                    };\r\n                  });\r\n\r\n                  processedData[stockCode] = processedTimeData;\r\n                }\r\n\r\n                resolve(processedData);\r\n              } catch (error) {\r\n                console.error('解析分时数据失败:', error);\r\n                reject(error);\r\n              }\r\n            },\r\n            error: (error) => {\r\n              console.error('获取分时详细数据失败:', error);\r\n              reject(error);\r\n            },\r\n            notClient: () => {\r\n              console.error('API客户端不可用');\r\n              reject(new Error('API客户端不可用'));\r\n            },\r\n          });\r\n        },\r\n        error: (error) => {\r\n          console.error('请求分时数据失败:', error);\r\n          reject(error);\r\n        },\r\n        notClient: () => {\r\n          console.error('API客户端不可用');\r\n          reject(new Error('API客户端不可用'));\r\n        },\r\n      });\r\n    } catch (error) {\r\n      console.error('fetchMinuteData 执行失败:', error);\r\n      reject(error);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n *获取实时行情数据\r\n * stockCodes 支持以下格式：\r\n * - 单个股票代码字符串: '33:301357'\r\n * - 股票代码数组: ['33:301357', '20:513050']\r\n * 返回格式：\r\n * {\"33:301357\":{\"NEW\":\"80.7200\",\"PRE\":\"50.0000\",\"ZHANGDIEFU\":\"6.5892\"}}\r\n * @param {*} stockCodes\r\n * @returns\r\n */\r\nexport async function fetchRealTimeQuote(stockCodes) {\r\n  return new Promise((resolve, reject) => {\r\n    // 第一步：请求实时行情数据\r\n    window.API.use({\r\n      method: 'Quote.request',\r\n      data: {\r\n        code: stockCodes,\r\n        type: ['NEW', 'ZHANGDIEFU', 'OPEN'],\r\n        period: 'now',\r\n      },\r\n      callbackName: 'onready',\r\n      success: (data) => {\r\n        // 第二步：获取详细数据\r\n        window.API.use({\r\n          method: 'Quote.getData2',\r\n          data: {\r\n            code: stockCodes,\r\n            type: ['NEW', 'ZHANGDIEFU', 'OPEN'],\r\n            period: 'now',\r\n            mode: 'after',\r\n          },\r\n          success: (res) => {\r\n            try {\r\n              const parsedData = JSON.parse(res);\r\n\r\n              // 通过NEW和ZHANGDIEFU计算昨收价\r\n              const processedData = {};\r\n              for (const [code, data] of Object.entries(parsedData)) {\r\n                const newPrice = parseFloat(data.NEW);\r\n                const zhangdiefu = parseFloat(data.ZHANGDIEFU);\r\n\r\n                // 计算昨收价：昨收价 = 当前价格 / (1 + 涨跌幅/100)\r\n                let prePrice = null;\r\n                if (!isNaN(newPrice) && !isNaN(zhangdiefu)) {\r\n                  prePrice = newPrice / (1 + zhangdiefu / 100);\r\n                  prePrice = parseFloat(prePrice.toFixed(4)); // 保留4位小数\r\n                }\r\n\r\n                processedData[code] = {\r\n                  NEW: data.NEW,\r\n                  PRE: prePrice ? prePrice.toString() : null,\r\n                  ZHANGDIEFU: data.ZHANGDIEFU,\r\n                  OPEN: data.OPEN,\r\n                };\r\n              }\r\n\r\n              resolve(processedData);\r\n            } catch (error) {\r\n              console.error('解析实时行情数据失败:', error);\r\n              reject(error);\r\n            }\r\n          },\r\n          error: (error) => {\r\n            console.error('获取实时行情详细数据失败:', error);\r\n            reject(error);\r\n          },\r\n          notClient: () => {\r\n            console.error('API客户端不可用');\r\n            reject(new Error('API客户端不可用'));\r\n          },\r\n        });\r\n      },\r\n      error: (error) => {\r\n        console.error('请求实时行情数据失败:', error, stockCodes);\r\n        reject(error);\r\n      },\r\n      notClient: () => {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 获取历史行情数据\r\n * 注意：该方法不太可靠，只有切到具体股票时才能准确获取数据，不要太依赖这个方法\r\n * @param {string|string[]} stockCodes 股票代码，支持单个字符串或数组\r\n * @param {string} beginDate 开始日期，格式：YYYYMMDD，如：20250711\r\n * @param {string} endDate 结束日期，格式：YYYYMMDD，如：20250714\r\n * @returns {Promise<Object>} 返回历史行情数据的Promise\r\n *\r\n * 返回数据格式示例：\r\n * {\r\n *   \"33:300033\": {\r\n *     \"20250711\": {\r\n *       \"CLOSE\": \"287.2500\",    // 收盘价\r\n *       \"OPEN\": \"275.0400\",     // 开盘价\r\n *       \"PRE\": \"275.0100\",      // 昨收价\r\n *       \"VOL\": \"25306788.000\",  // 成交量\r\n *       \"money\": \"7246381000.00\" // 成交额\r\n *     },\r\n *     \"20250714\": {\r\n *       \"CLOSE\": \"277.0800\",\r\n *       \"OPEN\": \"284.9200\",\r\n *       \"PRE\": \"287.2500\",\r\n *       \"VOL\": \"12702121\",\r\n *       \"money\": \"3532377800.00\"\r\n *     }\r\n *   }\r\n * }\r\n */\r\nexport async function fetchHistoryData(stockCodes, beginDate, endDate) {\r\n  return new Promise((resolve, reject) => {\r\n    // 确保 stockCodes 是数组格式\r\n    const codes = Array.isArray(stockCodes) ? stockCodes : [stockCodes];\r\n\r\n    // 第一步：请求历史数据\r\n    window.API.use({\r\n      method: 'Quote.request',\r\n      data: {\r\n        code: codes,\r\n        type: ['OPEN', 'CLOSE', 'PRE', 'VOL', 'money'],\r\n        period: 'day',\r\n        begin: beginDate,\r\n        end: endDate,\r\n      },\r\n      success: function (data) {\r\n        // 第二步：获取详细数据\r\n        window.API.use({\r\n          method: 'Quote.getData2',\r\n          data: {\r\n            code: codes,\r\n            type: ['OPEN', 'CLOSE', 'PRE', 'VOL', 'money'],\r\n            period: 'day',\r\n            mode: 'after',\r\n            time: {\r\n              begin: beginDate,\r\n              end: endDate,\r\n              timeFmt: 1,\r\n            },\r\n            updateMode: 1, // 这个参数如果不加的话在获取新股的k涨跌幅的时候会为空\r\n          },\r\n          success: function (data) {\r\n            try {\r\n              const parsedData = JSON.parse(data);\r\n              resolve(parsedData);\r\n            } catch (error) {\r\n              console.error('解析历史数据失败:', error);\r\n              reject(error);\r\n            }\r\n          },\r\n          error: function (error) {\r\n            console.error('获取历史详细数据失败:', error);\r\n            reject(error);\r\n          },\r\n          notClient: () => {\r\n            console.error('API客户端不可用');\r\n            reject(new Error('API客户端不可用'));\r\n          },\r\n        });\r\n      },\r\n      error: function (error) {\r\n        console.error('请求历史数据失败:', error);\r\n        reject(error);\r\n      },\r\n      notClient: () => {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 获取最近一个交易日\r\n * @param {string} date 查询日期，格式：YYYYMMDD，如：20250719，默认为当前日期\r\n * @returns {Promise<string>} 返回最近一个交易日的Promise\r\n */\r\nexport function getLatestTradeDate(date = null) {\r\n  return new Promise((resolve, reject) => {\r\n    // 如果没有指定日期，使用当前日期\r\n    const targetDate =\r\n      date || new Date().toISOString().slice(0, 10).replace(/-/g, '');\r\n\r\n    window.API.use({\r\n      method: 'Quote.getSHTradeDate',\r\n      data: targetDate,\r\n      success: function (result) {\r\n        resolve(result);\r\n      },\r\n      error: function (error) {\r\n        console.error('获取最近交易日失败:', error);\r\n        reject(error);\r\n      },\r\n      notClient: () => {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 获取上一个交易日\r\n * @param {string} date 查询日期，格式：YYYYMMDD，如：20250719，默认为当前日期\r\n * @returns {Promise<string>} 返回最近一个交易日的Promise\r\n */\r\nexport function getPreTradeDate(date = null) {\r\n  return new Promise((resolve, reject) => {\r\n    // 如果没有指定日期，使用当前日期\r\n    const targetDate =\r\n      date || new Date().toISOString().slice(0, 10).replace(/-/g, '');\r\n\r\n    window.API.use({\r\n      method: 'Quote.getPreSHTradeDate',\r\n      data: targetDate,\r\n      success: function (result) {\r\n        resolve(result);\r\n      },\r\n      error: function (error) {\r\n        console.error('获取最近交易日失败:', error);\r\n        reject(error);\r\n      },\r\n      notClient: () => {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 获取最近5个交易日日期列表\r\n * @param {string} date 起始日期，格式：YYYYMMDD，如：20250719，默认为当前日期\r\n * @returns {Promise<string[]>} 返回最近5个交易日日期数组的Promise，按时间倒序排列\r\n */\r\nexport function getPreviousTradeDates(date = null, count = 5) {\r\n  return new Promise((resolve, reject) => {\r\n    const targetDate = date || new Date().toISOString().slice(0, 10).replace(/-/g, '');\r\n    const dates = [];\r\n    let currentDate = targetDate;\r\n    \r\n    // 递归获取前一个交易日\r\n    const getNextDate = async () => {\r\n      if (dates.length >= count) {\r\n        resolve(dates); // 按时间倒序排列（最新的在前）\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        const prevDate = await getPreTradeDate(currentDate);\r\n        if (prevDate && prevDate !== currentDate) {\r\n          dates.push(prevDate);\r\n          currentDate = prevDate;\r\n          // 继续获取下一个交易日\r\n          setTimeout(() => getNextDate(), 50); // 添加延迟避免API调用过快\r\n        } else {\r\n          // 无法获取更多交易日，返回已获取的\r\n          resolve(dates);\r\n        }\r\n      } catch (error) {\r\n        console.error('获取交易日失败:', error);\r\n        reject(error);\r\n      }\r\n    };\r\n    \r\n    // 开始获取\r\n    getNextDate();\r\n  });\r\n}\r\n/**\r\n * 检查是否在交易时间内\r\n * @param {string} stockCode 股票代码，如：'300033'\r\n * @returns {Promise<boolean>} 返回是否在交易时间内的Promise\r\n */\r\nexport function isTradeTime(stockCode = '300033') {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Quote.isTradeTime',\r\n      data: stockCode,\r\n      success: function (isTradeTime) {\r\n        console.log('是否在交易时间内:', isTradeTime);\r\n        resolve(isTradeTime);\r\n      },\r\n      error: function (error) {\r\n        console.error('检查交易时间失败:', error);\r\n        reject(error);\r\n      },\r\n      notClient: () => {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 获取所有股票代码（集合竞价策略用）\r\n * @param {boolean} needMarket 是否需要市场信息，默认为1\r\n * @returns {Promise<Object[]>} 返回股票代码对象数组的Promise\r\n * 返回格式示例：[{code: '002402', marketId: '33'}, {code: '002418', marketId: '33'}, ...]\r\n */\r\nexport function getAllStockCodes(needMarket = 1) {\r\n  return new Promise((resolve, reject) => {\r\n    window.API.use({\r\n      method: 'Util.getAllBlockCode',\r\n      data: { needMarket },\r\n      success: function (data) {\r\n        try {\r\n          // 返回的是逗号分隔的股票代码字符串，需要转换为对象数组\r\n          const rawCodes = data.split(',').filter((code) => code.trim());\r\n          const stockCodes = rawCodes.map((fullCode) => {\r\n            const [marketId, code] = fullCode.split(':');\r\n            return {\r\n              code: code || '',\r\n              marketId: marketId || ''\r\n            };\r\n          });\r\n          resolve(stockCodes);\r\n        } catch (error) {\r\n          reject(new Error(`解析股票代码失败: ${error.message}`));\r\n        }\r\n      },\r\n      error: function (error) {\r\n        console.error('获取板块代码失败:', error);\r\n        reject(error);\r\n      },\r\n      notClient: function () {\r\n        console.error('API客户端不可用');\r\n        reject(new Error('API客户端不可用'));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 调起下单窗口\r\n * @param {number} cmdStatus 下单状态：0-买入(XD_MAIRU)，1-卖出(XD_MAICHU)\r\n * @param {string} stockCode 股票代码，如：'002402'\r\n * @param {string} price 价格，可选，默认为空字符串（使用当前市价）\r\n * @param {string} amount 数量，可选，默认为空字符串\r\n * @returns {Promise<any>} 返回下单结果的Promise\r\n */\r\nexport function placeOrder(cmdStatus, stockCode, price = '', amount = '') {\r\n  return new Promise((resolve, reject) => {\r\n    const strInfo = `<?xml version=\"1.0\" encoding=\"GB2312\"?><RealTime StockCode=\"${stockCode}\" Market=\"33\"><Bid><Price Selected=\"1\">${price}</Price><Amount>${amount}</Amount></Bid></RealTime>`;\r\n    const info =\r\n      'wt_startup=wt_startup=\\r\\nrealtime=' +\r\n      window.btoa(unescape(encodeURIComponent(strInfo)));\r\n\r\n    window.API.use({\r\n      method: 'XdMgr.fastCallXiadan',\r\n      data: {\r\n        cmd: cmdStatus === 0 ? 'XD_MAIRU' : 'XD_MAICHU',\r\n        code: stockCode,\r\n        amount: amount,\r\n        info: info,\r\n        default: false,\r\n        hide: false,\r\n        select: true,\r\n      },\r\n      success: function (data) {\r\n        console.log(`${cmdStatus === 0 ? '买入' : '卖出'}下单成功:`, stockCode, data);\r\n        resolve(data);\r\n      },\r\n      error: function (error) {\r\n        console.error(`${cmdStatus === 0 ? '买入' : '卖出'}下单失败:`, stockCode, error);\r\n        reject(error);\r\n      },\r\n      notClient: function () {\r\n        const errorMsg = 'API客户端不可用';\r\n        console.error(errorMsg);\r\n        reject(new Error(errorMsg));\r\n      },\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * 判断是否为交易日\r\n * @returns {Promise<boolean>} 是否为交易日\r\n * @throws {Error} 当API调用失败时抛出错误\r\n */\r\nexport async function isTradingDay() {\r\n  // 获取当前日期，格式：YYYYMMDD\r\n  const today = new Date().toISOString().slice(0, 10).replace(/-/g, '')\r\n\r\n  // 获取最近一个交易日\r\n  const latestTradeDate = await getLatestTradeDate(today)\r\n\r\n  // 如果今日等于最近交易日，说明今日是交易日\r\n  return today === latestTradeDate\r\n}\r\n\r\n/**\r\n * 基于本地时间判断是否在交易时段（包含集合竞价时间）\r\n * @returns {boolean} 是否在交易时段内\r\n * @description\r\n * 交易时段包括：\r\n * - 集合竞价：09:15-09:25\r\n * - 上午交易：09:30-11:30\r\n * - 下午交易：13:00-15:00\r\n * 注意：此方法不判断是否为交易日，仅判断时间段\r\n */\r\nexport function isInTradingHours() {\r\n  const now = new Date()\r\n  const hours = now.getHours()\r\n  const minutes = now.getMinutes()\r\n  const currentTime = hours * 100 + minutes // 转换为数字方便比较，如 09:15 -> 915\r\n\r\n  // 集合竞价时间：09:15-09:25\r\n  if (currentTime >= 915 && currentTime < 925) {\r\n    return true\r\n  }\r\n\r\n  // 上午交易时间：09:30-11:30\r\n  if (currentTime >= 930 && currentTime < 1130) {\r\n    return true\r\n  }\r\n\r\n  // 下午交易时间：13:00-15:00\r\n  if (currentTime >= 1300 && currentTime < 1500) {\r\n    return true\r\n  }\r\n\r\n  return false\r\n}\r\n\r\n/**\r\n * 判断是否在交易日的交易时段内（结合交易日判断和时段判断）\r\n * @returns {Promise<boolean>} 是否在交易日的交易时段内\r\n * @description\r\n * 同时满足两个条件：\r\n * 1. 是交易日（通过API查询交易日历）\r\n * 2. 在交易时段内（包含集合竞价）\r\n */\r\nexport async function isInTradingTime() {\r\n  // 先判断时段，避免非交易时段时调用API\r\n  if (!isInTradingHours()) {\r\n    return false\r\n  }\r\n\r\n  // 再判断是否为交易日\r\n  try {\r\n    return await isTradingDay()\r\n  } catch (error) {\r\n    console.error('判断交易日失败:', error)\r\n    return false\r\n  }\r\n}\r\n\r\n\r\nwindow.getAllStockCodes = getAllStockCodes; // for debug\r\n// 保持向后兼容性\r\nwindow.getAllBlockCode = getAllStockCodes;\r\nwindow.placeOrder = placeOrder; // for debug\r\nwindow.getLatestTradeDate = getLatestTradeDate; // for debug\r\nwindow.fetchMinuteData = fetchMinuteData; // for debug\r\nwindow.fetchRealTimeQuote = fetchRealTimeQuote; // for debug\r\nwindow.fetchHistoryData = fetchHistoryData;\r\nwindow.isTradeTime = isTradeTime;"],"names":["formatTimestamp","timestamp","format","date","hours","minutes","seconds","timestampToTimeString","jumpToQuote","code","stockCode","result","registerPush","codes","callback","quoteSessionId","data","stockData","unregisterPush","sessionId","addSelfStock","resolve","reject","error","getStocksByConceptCode","conceptCode","stockCodes","fetchMinuteData","targetDate","getLatestTradeDate","preCloseData","historyData","fetchHistoryData","parsedData","processedData","timeData","processedTimeData","entries","values","index","calculatedVol","prevValues","prevVol","calculatedMoney","prevMoney","timeStr","currentPrice","preClose","changePercent","fetchRealTimeQuote","res","newPrice","zhangdiefu","prePrice","beginDate","endDate","getPreTradeDate","isTradeTime","getAllStockCodes","needMarket","fullCode","marketId","placeOrder","cmdStatus","price","amount","strInfo","info","errorMsg","isInTradingHours","now","currentTime"],"mappings":"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"}