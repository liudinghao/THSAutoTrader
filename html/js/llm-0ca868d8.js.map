{"version":3,"file":"llm-0ca868d8.js","sources":["../../front/src/api/llm.js"],"sourcesContent":["// API配置\r\nconst API_CONFIG = {\r\n  deepseek: {\r\n    baseUrl: 'https://api.deepseek.com/v1/chat/completions',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Provider': 'deepseek',\r\n    },\r\n  },\r\n  kimi: {\r\n    baseUrl: '//api.moonshot.cn/v1/chat/completions',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'X-API-Provider': 'moonshot',\r\n    },\r\n  },\r\n};\r\n\r\n/**\r\n * 从本地存储获取配置\r\n * @param {string} apiKey - API密钥\r\n * @param {string} model - 模型名称\r\n * @returns {Object} 配置对象\r\n */\r\nfunction getConfig(apiKey, model) {\r\n  const savedModel = model || localStorage.getItem('selected_model') || 'kimi';\r\n  const key = `api_key_${savedModel}`;\r\n  const savedApiKey = apiKey || localStorage.getItem(key) || '';\r\n\r\n  // 根据模型返回对应的API配置\r\n  let provider = 'deepseek';\r\n  if (savedModel === 'kimi') {\r\n    provider = 'kimi';\r\n  }\r\n\r\n  return {\r\n    apiKey: savedApiKey,\r\n    model: savedModel,\r\n    provider: provider,\r\n    baseUrl: API_CONFIG[provider].baseUrl,\r\n    headers: API_CONFIG[provider].headers,\r\n  };\r\n}\r\n\r\n/**\r\n * 验证API密钥\r\n * @param {string} apiKey - API密钥\r\n * @param {string} model - 模型名称\r\n * @returns {Promise<boolean>} 验证结果\r\n */\r\nexport async function validateApiKey(apiKey, model) {\r\n  const config = getConfig(apiKey, model);\r\n  console.log('config', config);\r\n  const { apiKey: actualApiKey, baseUrl, headers } = config;\r\n\r\n  if (!actualApiKey) {\r\n    throw new Error('Please enter API key');\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(baseUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        ...headers,\r\n        Authorization: `Bearer ${actualApiKey}`,\r\n      },\r\n      body: JSON.stringify({\r\n        model: config.model === 'kimi' ? 'moonshot-v1-8k' : config.model,\r\n        messages: [{ role: 'user', content: 'test' }],\r\n        max_tokens: 5,\r\n      }),\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.error) {\r\n      if (data.error.code === 'invalid_api_key') {\r\n        throw new Error('Invalid API key, please check and try again');\r\n      }\r\n      throw new Error(data.error.message);\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * 发送消息到AI模型\r\n * @param {string} apiKey - API密钥\r\n * @param {string} model - 模型名称\r\n * @param {Array} messages - 消息历史\r\n * @param {number} temperature - 温度参数\r\n * @returns {Promise<Object>} 响应结果\r\n */\r\nexport async function sendMessage(apiKey, model, messages, temperature) {\r\n  const config = getConfig(apiKey, model);\r\n  const actualApiKey = config.apiKey;\r\n  const baseUrl = config.baseUrl;\r\n  const headers = config.headers;\r\n\r\n  if (!actualApiKey) {\r\n    throw new Error('Please enter API key');\r\n  }\r\n\r\n  try {\r\n    let requestBody = {};\r\n\r\n    if (config.provider === 'kimi') {\r\n      // Kimi 模型配置，支持联网搜索\r\n      requestBody = {\r\n        model: 'moonshot-v1-8k',\r\n        messages,\r\n        temperature,\r\n        tools: [\r\n          {\r\n            type: 'function',\r\n            function: {\r\n              name: 'web_search',\r\n              description: 'Search the web for current information',\r\n              parameters: {\r\n                type: 'object',\r\n                properties: {\r\n                  query: {\r\n                    type: 'string',\r\n                    description: 'The search query',\r\n                  },\r\n                },\r\n                required: ['query'],\r\n              },\r\n            },\r\n          },\r\n        ],\r\n        tool_choice: 'auto',\r\n      };\r\n    } else {\r\n      // DeepSeek 模型配置\r\n      requestBody = {\r\n        model: config.model,\r\n        messages,\r\n        temperature,\r\n      };\r\n    }\r\n\r\n    const response = await fetch(baseUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        ...headers,\r\n        Authorization: `Bearer ${actualApiKey}`,\r\n      },\r\n      body: JSON.stringify(requestBody),\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.error) {\r\n      throw new Error(data.error.message);\r\n    }\r\n\r\n    if (!data.choices || !data.choices[0]) {\r\n      throw new Error('Request failed');\r\n    }\r\n\r\n    return data.choices[0].message;\r\n  } catch (error) {\r\n    throw error;\r\n  }\r\n}\r\n"],"names":["API_CONFIG","getConfig","apiKey","model","savedModel","key","savedApiKey","provider","validateApiKey","config","actualApiKey","baseUrl","headers","data","error","sendMessage","messages","temperature","requestBody"],"mappings":"AACA,MAAMA,EAAa,CACjB,SAAU,CACR,QAAS,+CACT,QAAS,CACP,eAAgB,mBAChB,iBAAkB,UACnB,CACF,EACD,KAAM,CACJ,QAAS,wCACT,QAAS,CACP,eAAgB,mBAChB,iBAAkB,UACnB,CACF,CACH,EAQA,SAASC,EAAUC,EAAQC,EAAO,CAChC,MAAMC,EAAaD,GAAS,aAAa,QAAQ,gBAAgB,GAAK,OAChEE,EAAM,WAAWD,CAAU,GAC3BE,EAAcJ,GAAU,aAAa,QAAQG,CAAG,GAAK,GAG3D,IAAIE,EAAW,WACf,OAAIH,IAAe,SACjBG,EAAW,QAGN,CACL,OAAQD,EACR,MAAOF,EACP,SAAUG,EACV,QAASP,EAAWO,CAAQ,EAAE,QAC9B,QAASP,EAAWO,CAAQ,EAAE,OAClC,CACA,CAQO,eAAeC,EAAeN,EAAQC,EAAO,CAClD,MAAMM,EAASR,EAAUC,EAAQC,CAAK,EACtC,QAAQ,IAAI,SAAUM,CAAM,EAC5B,KAAM,CAAE,OAAQC,EAAc,QAAAC,EAAS,QAAAC,CAAO,EAAKH,EAEnD,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,sBAAsB,EAGxC,GAAI,CAcF,MAAMG,EAAO,MAbI,MAAM,MAAMF,EAAS,CACpC,OAAQ,OACR,QAAS,CACP,GAAGC,EACH,cAAe,UAAUF,CAAY,EACtC,EACD,KAAM,KAAK,UAAU,CACnB,MAAOD,EAAO,QAAU,OAAS,iBAAmBA,EAAO,MAC3D,SAAU,CAAC,CAAE,KAAM,OAAQ,QAAS,MAAM,CAAE,EAC5C,WAAY,CACpB,CAAO,CACP,CAAK,GAE2B,OAE5B,GAAII,EAAK,MACP,MAAIA,EAAK,MAAM,OAAS,kBAChB,IAAI,MAAM,6CAA6C,EAEzD,IAAI,MAAMA,EAAK,MAAM,OAAO,EAEpC,MAAO,EACR,OAAQC,EAAO,CACd,MAAMA,CACP,CACH,CAUO,eAAeC,EAAYb,EAAQC,EAAOa,EAAUC,EAAa,CACtE,MAAMR,EAASR,EAAUC,EAAQC,CAAK,EAChCO,EAAeD,EAAO,OACtBE,EAAUF,EAAO,QACjBG,EAAUH,EAAO,QAEvB,GAAI,CAACC,EACH,MAAM,IAAI,MAAM,sBAAsB,EAGxC,GAAI,CACF,IAAIQ,EAAc,CAAA,EAEdT,EAAO,WAAa,OAEtBS,EAAc,CACZ,MAAO,iBACP,SAAAF,EACA,YAAAC,EACA,MAAO,CACL,CACE,KAAM,WACN,SAAU,CACR,KAAM,aACN,YAAa,yCACb,WAAY,CACV,KAAM,SACN,WAAY,CACV,MAAO,CACL,KAAM,SACN,YAAa,kBACd,CACF,EACD,SAAU,CAAC,OAAO,CACnB,CACF,CACF,CACF,EACD,YAAa,MACrB,EAGMC,EAAc,CACZ,MAAOT,EAAO,MACd,SAAAO,EACA,YAAAC,CACR,EAYI,MAAMJ,EAAO,MATI,MAAM,MAAMF,EAAS,CACpC,OAAQ,OACR,QAAS,CACP,GAAGC,EACH,cAAe,UAAUF,CAAY,EACtC,EACD,KAAM,KAAK,UAAUQ,CAAW,CACtC,CAAK,GAE2B,OAE5B,GAAIL,EAAK,MACP,MAAM,IAAI,MAAMA,EAAK,MAAM,OAAO,EAGpC,GAAI,CAACA,EAAK,SAAW,CAACA,EAAK,QAAQ,CAAC,EAClC,MAAM,IAAI,MAAM,gBAAgB,EAGlC,OAAOA,EAAK,QAAQ,CAAC,EAAE,OACxB,OAAQC,EAAO,CACd,MAAMA,CACP,CACH"}