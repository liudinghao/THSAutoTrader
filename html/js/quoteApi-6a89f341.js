function N(o,n="HH:mm:00"){const t=new Date(parseInt(o)*1e3),r=t.getHours().toString().padStart(2,"0"),e=t.getMinutes().toString().padStart(2,"0"),a=t.getSeconds().toString().padStart(2,"0");return n.replace("HH",r).replace("mm",e).replace("ss",a)}function F(o){return N(o,"HH:mm:00")}function H(o,n){API.use({method:"Quote.syncStockList",data:{id:379,code:o,period:"8192",stocklist:n.join("|")},success:function(t){}})}function Q(o,n){var t=window.API.createSessionId("Quote");return console.log("quoteSessionId:",t),window.API.use({method:"Quote.registerPush",data:{code:o.join(",")},sessionId:t,persistent:!0,callbackName:"onready",success:function(r){window.API.use({method:"Quote.getData2",data:{code:o.join(","),type:["NEW","ZHANGDIEFU","ZHANGSHU"],period:"now",mode:"after"},success:function(e){const a=JSON.parse(e);console.log("registerPush:",e),n(a)}})}}),t}function C(o){window.API.use({method:"Quote.unregisterPush",sessionId:o,success:function(n){o=null,customLog("取消监听成功")}})}function U(o){return new Promise((n,t)=>{window.API.use({method:"Quote.setSelfStock",data:{mode:"add",code:o.join(",")},success:function(r){n(r)},error:function(r){t(r)}})})}function L(o){return new Promise((n,t)=>{window.API.use({method:"Util.getBlockStockByCode",data:o,success:function(r){try{const e=r.split(",").filter(a=>a.trim());console.log(`概念 ${o} 获取到 ${e.length} 只股票:`,e),n(e)}catch(e){t(new Error(`解析股票代码失败: ${e.message}`))}},error:function(r){t(new Error(`获取概念股票失败: ${r.message}`))}})})}async function T(o,n=null){return new Promise(async(t,r)=>{try{const e=n||new Date().toISOString().slice(0,10).replace(/-/g,""),a={};try{const c=await O(o,e,e);for(const[i,s]of Object.entries(c))s&&s[e]&&s[e].PRE&&(a[i]=parseFloat(s[e].PRE))}catch(c){console.warn("获取昨收价失败，将使用默认值:",c)}window.API.use({method:"Quote.request",data:{code:o,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",begin:e,withmarket:!1,end:e,timeFmt:1},success:c=>{window.API.use({method:"Quote.getData2",data:{code:o,withmarket:!1,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",timeStamp:1,updateMode:1,time:{begin:e,end:e,timeFmt:1}},success:i=>{try{const s=JSON.parse(i);console.log("fetchMinuteData: 获取分时原始数据完成",s);const d={};for(const[l,u]of Object.entries(s)){const h={},P=Object.entries(u);P.forEach(([E,m],w)=>{let f=parseFloat(m.VOL||0);if(w>0){const g=P[w-1][1],A=parseFloat(g.VOL||0);f=Math.max(0,f-A)}let I=parseFloat(m.money||0);if(w>0){const g=P[w-1][1],A=parseFloat(g.money||0);I=Math.max(0,I-A)}const S=F(E),D=parseFloat(m.NEW||m.JUNJIA||0),p=a[l];let y=0;p&&p>0&&(y=(D-p)/p*100),h[S]={...m,VOL:f.toString(),money:I.toString(),changePercent:parseFloat(y.toFixed(2)),preClose:p||null}}),d[l]=h}t(d)}catch(s){console.error("解析分时数据失败:",s),r(s)}},error:i=>{console.error("获取分时详细数据失败:",i),r(i)},notClient:()=>{console.error("API客户端不可用"),r(new Error("API客户端不可用"))}})},error:c=>{console.error("请求分时数据失败:",c),r(c)},notClient:()=>{console.error("API客户端不可用"),r(new Error("API客户端不可用"))}})}catch(e){console.error("fetchMinuteData 执行失败:",e),r(e)}})}async function k(o){return new Promise((n,t)=>{window.API.use({method:"Quote.request",data:{code:o,type:["NEW","ZHANGDIEFU"],period:"now"},callbackName:"onready",success:r=>{window.API.use({method:"Quote.getData2",data:{code:o,type:["NEW","ZHANGDIEFU"],period:"now",mode:"after"},success:e=>{try{const a=JSON.parse(e),c={};for(const[i,s]of Object.entries(a)){const d=parseFloat(s.NEW),l=parseFloat(s.ZHANGDIEFU);let u=null;!isNaN(d)&&!isNaN(l)&&(u=d/(1+l/100),u=parseFloat(u.toFixed(4))),c[i]={NEW:s.NEW,PRE:u?u.toString():null,ZHANGDIEFU:s.ZHANGDIEFU}}n(c)}catch(a){console.error("解析实时行情数据失败:",a),t(a)}},error:e=>{console.error("获取实时行情详细数据失败:",e),t(e)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})},error:r=>{console.error("请求实时行情数据失败:",r),t(r)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})})}async function O(o,n,t){return new Promise((r,e)=>{const a=Array.isArray(o)?o:[o];window.API.use({method:"Quote.request",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",begin:n,end:t},success:function(c){window.API.use({method:"Quote.getData2",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",mode:"after",time:{begin:n,end:t,timeFmt:1},updateMode:1},success:function(i){try{const s=JSON.parse(i);console.log("fetchHistoryData: 获取历史数据完成",s),r(s)}catch(s){console.error("解析历史数据失败:",s),e(s)}},error:function(i){console.error("获取历史详细数据失败:",i),e(i)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})},error:function(c){console.error("请求历史数据失败:",c),e(c)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})})}function V(o=null){return new Promise((n,t)=>{const r=o||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getSHTradeDate",data:r,success:function(e){n(e)},error:function(e){console.error("获取最近交易日失败:",e),t(e)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})})}function b(o=null){return new Promise((n,t)=>{const r=o||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getPreSHTradeDate",data:r,success:function(e){n(e)},error:function(e){console.error("获取最近交易日失败:",e),t(e)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})})}function J(o){return new Promise((n,t)=>{window.API.use({method:"Quote.isTradeTime",data:o,success:function(r){console.log("是否在交易时间内:",r),n(r)},error:function(r){console.error("检查交易时间失败:",r),t(r)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})})}export{T as a,k as b,U as c,b as d,L as e,O as f,V as g,J as i,H as j,Q as r,C as u};
//# sourceMappingURL=quoteApi-6a89f341.js.map
