import{_ as ye,i as B,k as be,l as xe,D as re,r as X,o as Z,f as ae,d as j,b as J,h as ne,J as ue,w as H,K as me,E as G,I as pe,e as se,F as we,m as ke,a as ie,p as Pe,t as ee,u as _e,v as De}from"./index-a0dcb939.js";import{g as Le,a as ce,i as Ce,d as Fe}from"./quoteApi-6a89f341.js";import{i as Oe}from"./index-79ad53b8.js";const $e={class:"intraday-chart-container"},Ne={key:0,class:"loading-overlay"},Me={__name:"IntradayChart",props:{stockData:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},height:{type:[String,Number],default:"500px"},legendLabels:{type:Object,default:()=>({})}},emits:["chartUpdate","chartClick","dataPointClick"],setup(h,{expose:y,emit:r}){const i=h,l=r,e=B(null),P=B(null),S=(()=>{const n=c=>c.toString().padStart(2,"0"),a=[];for(let c=9,s=30;c<12&&(a.push(`${n(c)}:${n(s)}:00`),s++,s===60&&(c++,s=0),!(c===11&&s>30)););for(let c=13,s=1;c<16&&(a.push(`${n(c)}:${n(s)}:00`),s++,s===60&&(c++,s=0),!(c===15&&s>0)););return a})(),O=["#1890ff","#f56c6c","#67c23a","#e6a23c","#98D8C8","#ff7875","#95de64","#ffc53d","#b37feb","#ff85c0"],I=n=>{if(!n.minuteData||n.minuteData.length===0)return{prices:[],volumes:[],avgPrice:[],change:[],changePercent:[],junjia:[],rawData:{}};const a=parseFloat(n.preClose)||0;if(n.rawData){const _=[],t=[],o=[],x=[],b=[],L=[];return S.forEach(W=>{const R=n.rawData[W];if(R){const V=parseFloat(R.NEW||0),p=parseFloat(R.JUNJIA||V),v=parseFloat(R.VOL||0);if(_.push(V),L.push(p),t.push(v),a>0){const F=(V-a)/a*100;b.push(parseFloat(F.toFixed(2))),x.push(parseFloat((V-a).toFixed(3)))}else b.push(0),x.push(0)}else _.push(null),L.push(null),t.push(null),b.push(null),x.push(null)}),{prices:_,volumes:t,avgPrice:o,change:x,changePercent:b,junjia:L,rawData:n.rawData}}const c=new Map(n.minuteData.map(_=>[_[0],_[1]])),s=[],M=[],Y=[],K=[],T=[],N=[];return S.forEach((_,t)=>{const o=c.get(_);if(o!=null){const x=parseFloat(o);T.push(x);const b=a>0?a*(1+x/100):0;s.push(parseFloat(b.toFixed(3))),K.push(parseFloat((b-a).toFixed(3))),N.push(parseFloat(b.toFixed(3))),M.push(null)}else s.push(null),N.push(null),M.push(null),T.push(null),K.push(null)}),{prices:s,volumes:M,avgPrice:Y,change:K,changePercent:T,junjia:N,rawData:{}}},$=()=>{if(!i.stockData||i.stockData.length===0)return{mainStock:null,otherStocks:[]};const n=I(i.stockData[0]),a=[];for(let c=1;c<i.stockData.length;c++){const s=i.stockData[c],M=I(s);a.push({stock:s,changePercent:M.changePercent,name:s.name,code:s.code})}return{mainStock:n,otherStocks:a}},f=(n,a,c)=>n.filter(M=>M!==null).length===0?{min:a*.95,max:a*1.05,center:a}:{min:a*(1+c.min/100),max:a*(1+c.max/100),center:a},d=(n,a)=>{let c=[];if(n&&(c=c.concat(n.changePercent.filter(N=>N!==null))),a.forEach(N=>{c=c.concat(N.changePercent.filter(_=>_!==null))}),c.length===0)return{min:-5,max:5};const s=Math.max(...c),M=Math.min(...c),Y=Math.max(Math.abs(s),Math.abs(M),1),K=Y*.1,T=Y+K;return{min:-T,max:T}},D=n=>{const a=[];for(let c=0;c<n;c++)a.push(O[c%O.length]);return a},w=(n,a)=>{if(!n.sellPoints||n.sellPoints.length===0)return null;const c=n.sellPoints.map(s=>{const M=a.findIndex(_=>_===s.time);if(M===-1)return null;const Y=s.symbol||"arrow",K=s.symbolRotate||0,T=s.color||"#f56c6c",N=s.label||"卖点";return{coord:[M,s.price],value:s.price,symbol:Y,symbolRotate:K,itemStyle:{color:T},label:{show:!0,formatter:N,color:"#fff",fontSize:10,fontWeight:"bold",backgroundColor:T,padding:[2,6],borderRadius:4,position:"top"}}}).filter(s=>s!==null);return c.length===0?null:{symbolSize:12,data:c}},k=(n,a)=>{if(!n.buyPoints||n.buyPoints.length===0)return null;const c=n.buyPoints.map(s=>{const M=a.findIndex(_=>_===s.time);if(M===-1)return null;const Y=s.symbol||"arrow",K=s.symbolRotate||0,T=s.color||"#ff4d4f",N=s.label||"买点";return{coord:[M,s.price],value:s.price,symbol:Y,symbolRotate:K,itemStyle:{color:T},label:{show:!0,formatter:N,color:"#fff",fontSize:10,fontWeight:"bold",backgroundColor:T,padding:[2,6],borderRadius:4,position:"bottom"}}}).filter(s=>s!==null);return c.length===0?null:{symbolSize:12,data:c}},m=()=>{var V;if(!P.value||!((V=i.stockData)!=null&&V.length))return;const n=$(),{mainStock:a,otherStocks:c}=n;if(!a)return;const s=i.stockData[0],M=parseFloat(s.preClose),Y=d(a,c),K=f(a.prices,M,Y),T=a.volumes.filter(p=>p!==null&&p>0),N=T.length>0?Math.max(...T):0,_={max:N>0?N*1.2:1e3},t={silent:!0,symbol:"none",label:{show:!1},lineStyle:{color:"#000000",width:1,type:"solid"},data:[{yAxis:M,lineStyle:{color:"#000000",width:1}}]},o=(p,v)=>{const F=w(p,v),z=k(p,v),u=[];return F!=null&&F.data&&u.push(...F.data),z!=null&&z.data&&u.push(...z.data),u.length===0?null:{symbolSize:12,data:u}},x=(p,v=0)=>{const F=`${p.code}_${v}`;return i.legendLabels[F]||i.legendLabels[p.code]||`${p.name}(${p.code})`},b=[],L=D(1+c.length),W=x(s,0);b.push({name:W,type:"line",data:a.prices,smooth:!1,symbol:"none",lineStyle:{color:L[0],width:2},itemStyle:{color:L[0]},markLine:t,markPoint:o(s,S)}),b.push({name:`${s.name}(${s.code}) 均价`,type:"line",data:a.junjia,smooth:!1,symbol:"none",lineStyle:{color:"#FFB400",width:1,type:"solid"},itemStyle:{color:"#FFB400"},legendHoverLink:!1}),b.push({name:`${s.name}(${s.code}) 成交量`,type:"bar",xAxisIndex:1,yAxisIndex:2,data:a.volumes.map(p=>p!==null?p:0),itemStyle:{color:function(p){a.changePercent[p.dataIndex];const v=a.prices[p.dataIndex],F=p.dataIndex===0?M:a.prices[p.dataIndex-1];return v>F?"#f56c6c":v<F?"#67c23a":"#c5c5c5"}},barWidth:"60%",legendHoverLink:!1}),c.forEach((p,v)=>{b.push({name:`${p.name}(${p.code})`,type:"line",yAxisIndex:1,data:p.changePercent,smooth:!1,symbol:"none",lineStyle:{color:L[v+1],width:1},itemStyle:{color:L[v+1]}})});const R={animation:!1,title:{show:!1,text:`${s.name}(${s.code}) 分时图${c.length>0?` + ${c.length}只股票对比`:""}`,left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{show:!1},legend:{data:[`${s.name}(${s.code})`,...c.map(p=>`${p.name}(${p.code})`)],top:10,textStyle:{fontSize:12}},axisPointer:{link:[{xAxisIndex:"all"}],label:{backgroundColor:"#777"}},grid:[{left:"10%",right:"8%",height:"60%",top:"10%"},{left:"10%",right:"8%",top:"75%",height:"15%"}],xAxis:[{type:"category",data:S,boundaryGap:!1,axisLine:{onZero:!1,lineStyle:{color:"#333"}},splitLine:{show:!0,lineStyle:{color:"#f5f5f5"}},axisLabel:{interval:function(p,v){const F=v.substring(0,5);return["09:30","10:00","10:30","11:00","11:30","13:30","14:00","14:30","15:00"].includes(F)},formatter:function(p){return p.substring(0,5)},color:"#666"},axisTick:{alignWithLabel:!0},axisPointer:{z:100},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.3)","rgba(245,245,245,0.3)"]}}},{type:"category",gridIndex:1,data:S,boundaryGap:!1,axisLine:{onZero:!1,lineStyle:{color:"#333"}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1}}],yAxis:[{type:"value",name:"价格",axisLine:{show:!0,lineStyle:{color:"#777"}},splitLine:{show:!0,lineStyle:{color:"#eee",type:"dashed"}},axisLabel:{formatter:function(p){return p.toFixed(3)},color:"#333"},min:K.min,max:K.max,scale:!0},{type:"value",name:"涨跌幅",position:"right",axisLine:{show:!0,lineStyle:{color:"#777"}},splitLine:{show:!1},axisLabel:{formatter:function(p){return p.toFixed(2)+"%"},color:function(p){return p>0?"#f56c6c":p<0?"#67c23a":"#666"}},min:Y.min,max:Y.max,scale:!0},{type:"value",name:"",gridIndex:1,splitNumber:2,axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1},min:0,max:_.max,scale:!0}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100}],series:b};P.value.setOption(R,!0),l("chartUpdate",{option:R,stockData:i.stockData,processedData:n})},C=()=>{m()},E=()=>{P.value&&P.value.resize()};return be(()=>{e.value&&(P.value=Oe(e.value),P.value.on("click",n=>{l("chartClick",n)}),P.value.on("mouseover",n=>{l("dataPointClick",n)}),C()),window.addEventListener("resize",E)}),xe(()=>{P.value&&P.value.dispose(),window.removeEventListener("resize",E)}),re(()=>i.stockData,(n,a)=>{console.log("IntradayChart stockData 发生变化:",{newLength:n==null?void 0:n.length,oldLength:a==null?void 0:a.length,hasMinuteData:n==null?void 0:n.some(c=>c.minuteData&&c.minuteData.length>0)}),C()},{deep:!0}),re(()=>i.height,()=>{E()}),y({updateChart:C,resizeChart:E,getChartInstance:()=>P.value}),(n,a)=>{const c=X("el-loading-spinner");return Z(),ae("div",$e,[h.loading?(Z(),ae("div",Ne,[j(c),a[0]||(a[0]=J("span",null,"正在加载分时数据...",-1))])):ne("",!0),J("div",{ref_key:"chartRef",ref:e,class:"intraday-chart",style:ue({height:h.height})},null,4)])}}},Ae=ye(Me,[["__scopeId","data-v-1ec76d75"]]);function Ie(h,y={},r=[]){const i=[],l={riskLevel:"low",sellSignals:0,recommendations:[]};if(!h||typeof h!="object"||Array.isArray(h))return l.recommendations.push("数据格式错误，需要对象格式"),i;const e=Object.entries(h).map(([d,D])=>({[d]:D}));if(e.length===0)return l.recommendations.push("数据为空，无法进行分析"),i;const{limitUpPrice:P,limitDownPrice:g}=y;if(P!==void 0&&e.every(D=>{const w=parseFloat(D[Object.keys(D)[0]].NEW);return Math.abs(w-P)<.01}))return l.recommendations.push("当前为涨停状态，常规卖出信号不适用"),l.riskLevel="低",{sellPoints:i,summary:l};const S=Ee(h,y,r);S&&(i.push(S),l.sellSignals++,l.recommendations.push("高位放量滞涨，建议全仓卖出"));let O=0,I=0;e.forEach((d,D)=>{const w=Object.keys(d)[0],k=d[w],m=parseFloat(k.NEW);m>O&&(O=m,I=D)});for(let d=I+1;d<e.length;d++){const D=Object.keys(e[d])[0],w=e[d][D],k=parseFloat(w.NEW);if(k<O*.99){i.push({...te.首次回调,type:"首次回调",time:D,price:k,volume:w.VOL,description:`从最高点${O}回落超过1%，短期见顶信号`,signal:"medium",index:d}),l.sellSignals++,l.recommendations.push("检测到首次回调，注意风险");break}}if(i.some(d=>d.type==="首次回调")){const D=i.find(m=>m.type==="首次回调").index;let w=parseFloat(e[D][Object.keys(e[D])[0]].NEW),k=D;for(let m=D+1;m<e.length;m++){const C=parseFloat(e[m][Object.keys(e[m])[0]].NEW);C<w&&(w=C,k=m)}for(let m=k+1;m<e.length;m++){const C=parseFloat(e[m][Object.keys(e[m])[0]].NEW);if(C>=w*1.01){const E=parseFloat(e[m][Object.keys(e[m])[0]].VOL),n=parseFloat(e[I][Object.keys(e[I])[0]].VOL);E<n&&(i.push({...te.反弹乏力,type:"反弹乏力",time:Object.keys(e[m])[0],price:C,volume:E,description:"反弹但成交量不足，买盘乏力",signal:"strong",index:m}),l.sellSignals++,l.recommendations.push("反弹乏力，建议卖出"));break}}}const f=e.slice(-30);if(f.length>0){const d=f.map(m=>{const C=Object.keys(m)[0];return parseFloat(m[C].NEW)}),D=f.map(m=>{const C=Object.keys(m)[0];return parseFloat(m[C].VOL)}),w=d.reduce((m,C)=>m+C,0)/d.length,k=D.reduce((m,C)=>m+C,0)/D.length;for(let m=f.length-1;m>=0;m--){const C=Object.keys(f[m])[0],E=f[m][C],n=parseFloat(E.NEW),a=parseFloat(E.VOL);if(n<w*.99&&a>k*1.2){const c=e.length-f.length+m;i.push({...te.尾盘破位,type:"尾盘破位",time:C,price:n,volume:a,description:"尾盘放量破位，趋势转弱",signal:"strong",index:c}),l.sellSignals++,l.recommendations.push("尾盘破位，明日可能继续下跌")}}}for(let d=5;d<e.length;d++){const D=Object.keys(e[d])[0],w=e[d][D],k=parseFloat(w.NEW),m=parseFloat(w.VOL),C=parseFloat(e[d-1][Object.keys(e[d-1])[0]].NEW),E=de(e,d-1,5,"VOL");k<C*.99&&m>E*1.5&&(i.push({...te.盘中急跌放量,type:"盘中急跌放量",time:D,price:k,volume:m,description:"盘中急跌且放量，恐慌盘或主力砸盘",signal:"strong",index:d}),l.sellSignals++,l.recommendations.push("盘中急跌放量，短线需果断止损"))}if(y&&y.limitUpPrice!==void 0)for(let d=1;d<e.length;d++){const D=Object.keys(e[d-1])[0],w=e[d-1][D],k=parseFloat(w.NEW),m=Object.keys(e[d])[0],C=e[d][m],E=parseFloat(C.NEW),n=parseFloat(C.VOL),a=de(e,d-1,5,"VOL");Math.abs(k-y.limitUpPrice)<.01&&E<y.limitUpPrice-.01&&n>a*1.5&&(i.push({...te.涨停打开且放量,type:"涨停打开且放量",time:m,price:E,volume:n,description:"涨停打开且放量，资金出逃",signal:"strong",index:d}),l.sellSignals++,l.recommendations.push("涨停打开且放量，短线需警惕回落风险"))}return l.sellSignals>=3?(l.riskLevel="高",l.recommendations.push("多个卖出信号叠加，强烈建议减仓或清仓")):l.sellSignals>=2?(l.riskLevel="中",l.recommendations.push("多个卖出信号，建议谨慎操作")):l.sellSignals>=1?(l.riskLevel="低",l.recommendations.push("单个卖出信号，注意观察")):l.recommendations.push("未检测到明显卖出信号，可继续持有"),{sellPoints:i,summary:l}}function de(h,y,r,i){let l=0,e=0;for(let P=Math.max(0,y-r+1);P<=y;P++){const g=Object.keys(h[P])[0];l+=parseFloat(h[P][g][i]),e++}return e>0?l/e:0}function Ee(h,y,r=[]){const i=Object.keys(h).sort(),l=[];for(let g=0;g<i.length;g+=5){const S=i.slice(g,g+5);S.length===5&&l.push(S)}if(l.length<3)return null;const e=l.map(g=>{const S=g.map($=>parseFloat(h[$].NEW)),O=g.map($=>parseFloat(h[$].VOL)),I=g.map($=>parseFloat(h[$].money));return{high:Math.max(...S),low:Math.min(...S),close:S[4],volume:O.reduce(($,f)=>$+f,0),money:I.reduce(($,f)=>$+f,0),avgAmountPerTrade:I.reduce(($,f)=>$+f,0)/(O.reduce(($,f)=>$+f,0)||1),startTime:g[0],endTime:g[4]}}),P=e.reduce((g,S)=>g+S.volume,0)/e.length;for(let g=2;g<e.length;g++){const S=e[g].endTime>="14:50:00",O=[g,g-1,g-2].every(k=>{var E,n;const m=e[k];return(m.high-m.low)/m.low<=(S?.015:.01)&&m.close<=Math.max(((E=e[k-1])==null?void 0:E.high)||0,((n=e[k-2])==null?void 0:n.high)||0)}),I=e[g-1].volume,f=(y.changePercent||0)>=5?1.5:2,d=e[g].volume>=I*f&&e[g].volume>=P*3,D=e[g].avgAmountPerTrade<e[g-1].avgAmountPerTrade*.9&&e[g-1].avgAmountPerTrade<e[g-2].avgAmountPerTrade*.9;let w=!0;if(r.length>0){let k=0;for(const m of r){const C=Object.keys(m).sort(),E=[];for(let n=0;n<C.length;n+=5){const a=C.slice(n,n+5);a.length===5&&E.push(a)}if(E.length>g){const n=E[g],a=n.map(N=>parseFloat(m[N].NEW)),c=n.map(N=>parseFloat(m[N].VOL));n.map(N=>parseFloat(m[N].money));const s=Math.max(...a),M=Math.min(...a),Y=(s-M)/M,K=c.reduce((N,_)=>N+_,0),T=E.map(N=>N.map(_=>parseFloat(m[_].VOL)).reduce((_,t)=>_+t,0)).reduce((N,_)=>N+_,0)/E.length;Y<=.01&&K>=T*3&&k++}}w=k>=2}if(O&&d&&D&&w)return{...te.高位放量滞涨,type:"高位放量滞涨",time:e[g].endTime,price:e[g].close,volume:e[g].volume,description:"高位放量滞涨，三维度同步验证，主力出货",signal:"strong",index:g}}return null}const te={高位放量滞涨:{symbol:"diamond",symbolRotate:0,color:"#ff4d4f",label:"高位滞涨"},首次回调:{symbol:"arrow",symbolRotate:180,color:"#fa8c16",label:"首次回调"},反弹乏力:{symbol:"circle",symbolRotate:0,color:"#722ed1",label:"反弹乏力"},尾盘破位:{symbol:"rect",symbolRotate:0,color:"#eb2f96",label:"尾盘破位"},盘中急跌放量:{symbol:"arrow",symbolRotate:270,color:"#f5222d",label:"急跌放量"},涨停打开且放量:{symbol:"star",symbolRotate:0,color:"#faad14",label:"涨停开板"},default:{symbol:"arrow",symbolRotate:180,color:"#f56c6c",label:"卖点"}};function je(h,y){if(!h||!y)return{limitUpPrice:void 0,limitDownPrice:void 0};const i=String(h)[0]==="3"?.2:.1,l=+(y*(1+i)).toFixed(2),e=+(y*(1-i)).toFixed(2);return{limitUpPrice:l,limitDownPrice:e}}function he(h,y){if(!Array.isArray(h)||!Array.isArray(y))throw new Error("输入必须是数组");if(h.length!==y.length)throw new Error("两个序列长度必须相同");if(h.length<2)return 0;const r=[];for(let f=0;f<h.length;f++)h[f]!==null&&y[f]!==null&&h[f]!==void 0&&y[f]!==void 0&&typeof h[f]=="number"&&typeof y[f]=="number"&&!isNaN(h[f])&&!isNaN(y[f])&&r.push([h[f],y[f]]);if(r.length<2)return 0;const i=r.length,l=r.reduce((f,d)=>f+d[0],0),e=r.reduce((f,d)=>f+d[1],0),P=l/i,g=e/i;let S=0,O=0,I=0;for(let f=0;f<i;f++){const[d,D]=r[f],w=d-P,k=D-g;S+=w*k,O+=w*w,I+=k*k}const $=Math.sqrt(O*I);return $===0?0:S/$}function ge(h){const y=Math.abs(h);let r="",i="";return y>=.9?(r="极强相关",i="extremely-strong"):y>=.8?(r="强相关",i="strong"):y>=.6?(r="中等相关",i="moderate"):y>=.4?(r="弱相关",i="weak"):y>=.2?(r="极弱相关",i="very-weak"):(r="不相关",i="none"),{similarity:Math.round(y*100),label:r,level:i,correlation:h,direction:h>0?"positive":h<0?"negative":"none"}}function oe(h,y=10){if(!Array.isArray(h)||h.length===0)return h;const r=Math.max(y,.01);return h.map(i=>typeof i!="number"||isNaN(i)?i:i/r*100)}function fe(h,y,r="changePercent",i=!0,l=!0){if(!h||!y)throw new Error("必须提供两个股票对象");let e,P,g,S;switch(r){case"prices":e=h.prices||[],P=y.prices||[],g=h.prevPrices||[],S=y.prevPrices||[];break;case"changePercent":if(e=h.changePercent||[],P=y.changePercent||[],g=h.prevChangePercent||[],S=y.prevChangePercent||[],i){const O=h.limitUpPercent||10,I=y.limitUpPercent||10;e=oe(e,O),P=oe(P,I),g=oe(g,O),S=oe(S,I)}break;default:throw new Error("数据类型必须是 prices 或 changePercent")}if(e.length===0||P.length===0)return console.log("数据为空，返回0%"),{correlation:0,similarity:0,label:"无数据",level:"none",direction:"none",validDataPoints:0,totalDataPoints:Math.max(e.length,P.length)};try{const O=he(e,P),I=ge(O);let $=null,f=null,d=null;if(l&&g.length>0&&S.length>0)try{const w=he(g,S),k=ge(w);$=w,f=k.similarity,d=k.label}catch(w){console.warn("计算上一日相似度失败:",w.message)}const D=e.filter((w,k)=>w!==null&&P[k]!==null&&typeof w=="number"&&typeof P[k]=="number"&&!isNaN(w)&&!isNaN(P[k])).length;return{...I,prevCorrelation:$,prevSimilarity:f,prevLabel:d,validDataPoints:D,totalDataPoints:e.length,dataType:r,hasPreviousData:g.length>0&&S.length>0}}catch(O){return console.error("计算股票相似度失败:",O),{correlation:0,similarity:0,prevCorrelation:null,prevSimilarity:null,prevLabel:null,label:"计算错误",level:"error",direction:"none",validDataPoints:0,totalDataPoints:Math.max(e.length,P.length),error:O.message,hasPreviousData:!1}}}const Te={class:"multi-stock-chart"},Ue={class:"header"},We={class:"header-controls"},Re={class:"stock-selector"},Ve={class:"chart-container"},ze={key:0,class:"loading-overlay"},Je={class:"stock-list"},Ye={style:{display:"flex","align-items":"center",gap:"8px"}},Ke={style:{"font-size":"11px",color:"#666","margin-top":"2px"}},Be={style:{display:"flex","align-items":"center",gap:"8px"}},He={style:{"font-size":"11px",color:"#666","margin-top":"2px"}},ve="multiStockChart_stockList",qe={__name:"MultiStockChart",setup(h){const y=B(null),r=B([]),i=B(!1),l=B(""),e=B(null),P=B(!1),g=B(null),S=B("17"),O=B(""),I=B(""),$=B(!1),f={17:"沪市A股",33:"深市A股",48:"概念",177:"港股",20:"港股基金"},d=async t=>{if(!(!t||t.length!==6)){$.value=!0;try{const x=await(await fetch(`https://www.wttiao.com/moni/quote/search?keyword=${t}`)).json();if(console.log("searchStock result:",x),x.code===0&&x.data&&x.data.length>0){const b=x.data[0];I.value=b.name||"",b.marketId&&f[b.marketId]?S.value=b.marketId.toString():t.startsWith("6")?S.value="17":(t.startsWith("0")||t.startsWith("3"))&&(S.value="33"),G.success(`找到股票: ${b.name}(${t})`)}else G.warning("未找到该股票信息")}catch(o){console.error("搜索股票失败:",o),G.error("搜索股票失败")}finally{$.value=!1}}},D=async()=>{if(!O.value||!S.value){G.warning("请选择市场并输入股票代码");return}const t=S.value,o=O.value.toUpperCase();if(r.value.find(W=>W.marketId===t&&W.code===o)){G.warning("该股票已添加");return}const b=I.value.trim()||o,L={marketId:t,marketName:f[t],code:o,name:b,price:"0.00",change:"0.00",preClose:null,minuteData:[]};r.value.push(L),O.value="",I.value="",k(),l.value&&await M()},w=t=>{r.value.splice(t,1),k()},k=()=>{try{localStorage.setItem(ve,JSON.stringify(r.value))}catch(t){console.error("保存到 localStorage 失败:",t),G.error("保存数据失败")}},m=()=>{try{const t=localStorage.getItem(ve);t&&(r.value=JSON.parse(t))}catch(t){console.error("从 localStorage 加载数据失败:",t),G.error("加载保存的数据失败")}},C=async()=>{if(r.value.length===0)return!1;try{const t=r.value[0],o=`${t.marketId}:${t.code}`;return await Ce(t.code)!==0}catch(t){return console.error("检查交易时间失败:",t),!1}},E=()=>{e.value&&clearInterval(e.value),e.value=setInterval(async()=>{const t=await C();if(P.value=t,t&&r.value.length>0)try{await s(),console.log("定时刷新完成")}catch(o){console.error("定时刷新数据失败:",o)}},1e3)},n=()=>{e.value&&(clearInterval(e.value),e.value=null)},a=async t=>{const o=t||new Date().toISOString().slice(0,10).replace(/-/g,"");return await Fe(o)},c=(t,o,x)=>{if(!x||!Array.isArray(x))return{updatedStockList:[],hasUpdates:!1};const b=[...x];let L=!1;return b.forEach((W,R)=>{const V=`${W.marketId}:${W.code}`,p=t[V],v=o?o[V]:null;if(p){const F=Object.entries(p).map(([U,A])=>[U,A.changePercent]);let z=[];v&&(z=Object.entries(v).map(([U,A])=>[U,A.changePercent]));const u={};Object.entries(p).forEach(([U,A])=>{u[U]={NEW:A.NEW,JUNJIA:A.JUNJIA,VOL:parseFloat(A.VOL||0),money:A.money,changePercent:A.changePercent,preClose:A.preClose}}),v&&Object.entries(v).forEach(([U,A])=>{A.NEW,A.JUNJIA,parseFloat(A.VOL||0),A.money,A.changePercent,A.preClose});const q=Object.values(p)[0],Q=(q==null?void 0:q.preClose)||null,le=z.length>0?z.map(U=>U[1]):W.prevChangePercent||[];if(b[R]={...W,minuteData:F,rawData:u,preClose:Q,changePercent:F.map(U=>U[1]),prevChangePercent:le},F.length>0){const U=Object.values(p).pop(),A=parseFloat((U==null?void 0:U.NEW)||(U==null?void 0:U.JUNJIA)||0),Se=F[F.length-1][1];b[R].price=A.toFixed(3),b[R].change=Se.toFixed(2)}L=!0}}),{updatedStockList:b,hasUpdates:L}},s=async()=>{if(!(r.value.length===0||!l.value))try{console.log("开始定时刷新分时数据...");const t=r.value.map(x=>`${x.marketId}:${x.code}`),o=await ce(t,l.value);if(o){const{updatedStockList:x,hasUpdates:b}=c(o,null,r.value);b&&r.value.splice(0,r.value.length,...x)}}catch(t){console.error("刷新分时数据失败:",t)}},M=async()=>{if(!(r.value.length===0||!l.value))try{i.value=!0;const t=r.value.map(L=>`${L.marketId}:${L.code}`),o=await ce(t,l.value),x=await a(l.value);console.log("yesterdayDate:",x,l.value);let b=null;try{b=await ce(t,x),console.log("昨日数据获取成功:",x)}catch(L){console.warn("昨日数据获取失败，使用空数据:",L.message),b={}}if(o){const L=r.value[0],W=o[`${L.marketId}:${L.code}`],{limitUpPrice:R,limitDownPrice:V}=je(L.code,L.preClose);L.limitUpPrice=R,L.limitDownPrice=V;const{sellPoints:p,summary:v}=Ie(W,L);g.value=v;const{updatedStockList:F}=c(o,b,r.value);F.length>0&&p.length>0&&(F[0].sellPoints=p),r.value.splice(0,r.value.length,...F)}}catch(t){console.error("获取分时数据失败:",t),G.error("获取分时数据失败")}finally{i.value=!1}},Y=async t=>{t&&r.value.length>0&&(console.log("日期已更改为:",t),await M())},K=async()=>{if(r.value.length===0){G.warning("没有股票数据可刷新");return}if(!l.value){G.warning("请先选择日期");return}const t=r.value.map(o=>({...o,minuteData:[],rawData:{}}));r.value.splice(0,r.value.length,...t),await M(),G.success("数据刷新成功")},T=t=>{console.log("图表已更新:",t)},N=t=>{const o=Number(t);return o>0?"positive-red":o<0?"negative-green":""},_=(t,o)=>{if(o===0||r.value.length===0)return{similarity:0,label:"--",level:"none",color:"#909399",prevSimilarity:null,prevLabel:null,prevColor:"#909399"};const x=r.value[0];if(!x||!t)return{similarity:0,label:"无数据",level:"none",color:"#909399",prevSimilarity:null,prevLabel:null,prevColor:"#909399"};const b=(v,F=!1)=>{const z=F?"prevChangePercent":"changePercent";return v[z]&&v[z].length>0?v[z]:v.rawData?Object.keys(v.rawData).sort().map(Q=>v.rawData[Q].changePercent||0):v.minuteData&&v.minuteData.length>0?v.minuteData.map(u=>u[1]||0):[]},L=b(x),W=b(t),R=b(x,!0),V=b(t,!0),p=v=>{switch(v){case"extremely-strong":case"strong":return"#f56c6c";case"moderate":return"#e6a23c";case"weak":return"#409eff";case"very-weak":case"none":return"#909399";default:return"#909399"}};try{let v=0,F="无数据",z="none";if(L.length>0&&W.length>0){const A=fe({changePercent:L},{changePercent:W},"changePercent");v=A.similarity,F=A.label,z=A.level}let u=null,q=null,Q="none";if(R.length>0&&V.length>0){const A=fe({changePercent:R},{changePercent:V},"changePercent");u=A.similarity,q=A.label,Q=A.level}return{similarity:v,label:F,level:z,color:p(z),prevSimilarity:u,prevLabel:q,prevLevel:Q,prevColor:p(Q)}}catch(v){return console.error("计算相似度失败:",v),{similarity:0,label:"计算错误",level:"error",color:"#909399",prevSimilarity:null,prevLabel:null,prevColor:"#909399"}}};return be(async()=>{try{const t=await Le();l.value=t,console.log("初始化日期为最近交易日:",t)}catch(t){console.error("获取最近交易日失败，使用当前日期:",t),l.value=new Date().toISOString().slice(0,10).replace(/-/g,"")}m(),l.value&&r.value.length>0&&await M(),E()}),xe(()=>{n()}),re(O,t=>{t&&t.length===6&&/^\d{6}$/.test(t)&&d(t)}),re(r,(t,o)=>{console.log("stockList 发生变化:",{newLength:t.length,oldLength:o==null?void 0:o.length,hasMinuteData:t.some(x=>x.minuteData&&x.minuteData.length>0)})},{deep:!0}),(t,o)=>{const x=X("el-date-picker"),b=X("el-icon"),L=X("el-button"),W=X("el-option"),R=X("el-select"),V=X("el-input"),p=X("el-loading-spinner"),v=X("el-table-column"),F=X("el-progress"),z=X("el-table");return Z(),ae("div",Te,[J("div",Ue,[o[5]||(o[5]=J("h2",null,"可视化操盘",-1)),J("div",We,[j(x,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=u=>l.value=u),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYYMMDD",style:{width:"150px","margin-right":"10px"},onChange:Y},null,8,["modelValue"]),j(L,{type:"primary",size:"small",loading:i.value,onClick:K},{default:H(()=>[j(b,null,{default:H(()=>[j(pe(_e))]),_:1}),o[4]||(o[4]=se(" 刷新数据 "))]),_:1,__:[4]},8,["loading"])])]),J("div",Re,[j(R,{modelValue:S.value,"onUpdate:modelValue":o[1]||(o[1]=u=>S.value=u),placeholder:"选择市场",style:{width:"120px","margin-right":"10px"}},{default:H(()=>[(Z(),ae(we,null,ke(f,(u,q)=>j(W,{key:q,label:u,value:q},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),j(V,{modelValue:O.value,"onUpdate:modelValue":o[2]||(o[2]=u=>O.value=u),placeholder:"请输入股票代码",style:{width:"200px","margin-right":"10px"},onKeyup:me(D,["enter"]),loading:$.value},{prefix:H(()=>[$.value?(Z(),ie(b,{key:0,class:"is-loading"},{default:H(()=>[j(pe(De))]),_:1})):ne("",!0)]),_:1},8,["modelValue","loading"]),j(V,{modelValue:I.value,"onUpdate:modelValue":o[3]||(o[3]=u=>I.value=u),placeholder:"请输入股票名称",style:{width:"200px","margin-right":"10px"},onKeyup:me(D,["enter"])},null,8,["modelValue"]),j(L,{type:"primary",onClick:D},{default:H(()=>o[6]||(o[6]=[se("添加")])),_:1,__:[6]})]),J("div",Ve,[j(Ae,{"stock-data":r.value,loading:i.value,height:"500px",onChartUpdate:T,ref_key:"intradayChartRef",ref:y},null,8,["stock-data","loading"]),i.value?(Z(),ae("div",ze,[j(p),o[7]||(o[7]=J("span",null,"正在加载分时数据...",-1))])):ne("",!0)]),J("div",Je,[o[9]||(o[9]=J("h3",null,"相似度标的",-1)),j(z,{data:r.value,style:{width:"100%"}},{default:H(()=>[j(v,{prop:"code",label:"股票代码",width:"120"}),j(v,{prop:"name",label:"股票名称",width:"150"}),j(v,{prop:"price",label:"当前价格",width:"100"}),j(v,{prop:"change",label:"涨跌幅",width:"100"},{default:H(u=>[J("span",{class:Pe(N(u.row.change))},ee(u.row.change>0?"+":"")+ee(u.row.change)+"% ",3)]),_:1}),j(v,{label:"相似度",width:"120"},{default:H(u=>[J("div",Ye,[u.$index!==0?(Z(),ie(F,{key:0,percentage:_(u.row,u.$index).similarity,color:_(u.row,u.$index).color,"stroke-width":6,"show-text":!1,style:{width:"60px"}},null,8,["percentage","color"])):ne("",!0),J("span",{style:ue({color:_(u.row,u.$index).color,fontSize:"12px",fontWeight:"bold"})},ee(u.$index===0?"--":_(u.row,u.$index).similarity+"%"),5)]),J("div",Ke,ee(u.$index===0?"":_(u.row,u.$index).label),1)]),_:1}),j(v,{label:"昨日相似度",width:"120"},{default:H(u=>[J("div",Be,[u.$index!==0?(Z(),ie(F,{key:0,percentage:_(u.row,u.$index).prevSimilarity||0,color:_(u.row,u.$index).prevColor||"#909399","stroke-width":6,"show-text":!1,style:{width:"60px"}},null,8,["percentage","color"])):ne("",!0),J("span",{style:ue({color:_(u.row,u.$index).prevColor||"#909399",fontSize:"12px",fontWeight:"bold"})},ee(u.$index===0?"--":(_(u.row,u.$index).prevSimilarity||0)+"%"),5)]),J("div",He,ee(u.$index===0?"":_(u.row,u.$index).prevLabel),1)]),_:1}),j(v,{label:"操作",width:"100"},{default:H(u=>[j(L,{type:"danger",size:"small",onClick:q=>w(u.$index)},{default:H(()=>o[8]||(o[8]=[se(" 删除 ")])),_:2,__:[8]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])])}}},Qe=ye(qe,[["__scopeId","data-v-a403390e"]]);export{Qe as default};
//# sourceMappingURL=MultiStockChart-46f90ea5.js.map
