import{_ as B,m as T,I as H,C as O,c as l,o as u,h,j as o,f as i,g as r,k as f,F as w,i as I,J as N,K as L,H as U,t as k,e as D}from"./index-8491b902.js";const g={baseUrl:"https://api.deepseek.com/v1/chat/completions",headers:{"Content-Type":"application/json","X-API-Provider":"deepseek"}};function K(t,e){const a=e||localStorage.getItem("selected_model")||"deepseek-chat",c=`api_key_${a}`;return{apiKey:t||localStorage.getItem(c)||"",model:a}}async function j(t,e){const a=K(t,e);if(!a.apiKey)throw new Error("请输入API密钥");try{const s=await(await fetch(g.baseUrl,{method:"POST",headers:{...g.headers,Authorization:`Bearer ${a.apiKey}`},body:JSON.stringify({model:a.model,messages:[{role:"user",content:"test"}],max_tokens:5})})).json();if(s.error)throw s.error.code==="invalid_api_key"?new Error("API密钥无效，请检查后重试"):new Error(s.error.message);return!0}catch(c){throw c}}async function J(t,e,a,c){const s=K(t,e);if(!s.apiKey)throw new Error("请输入API密钥");try{const p=await(await fetch(g.baseUrl,{method:"POST",headers:{...g.headers,Authorization:`Bearer ${s.apiKey}`},body:JSON.stringify({model:s.model,messages:a,temperature:c})})).json();if(p.error)throw new Error(p.error.message);if(!p.choices||!p.choices[0])throw new Error("请求失败");return p.choices[0].message}catch(d){throw d}}const F={"deepseek-chat":{label:"DeepSeek-Chat",value:"deepseek-chat",description:"用于一般对话"},"deepseek-reasoner":{label:"DeepSeek-Reasoner",value:"deepseek-reasoner",description:"用于推理和复杂问题"}},z={name:"LLMInterface",components:{Check:T,Setting:H,Delete:O},data(){return{config:{apiKey:"",model:"deepseek-chat",temperature:.7},messages:[],userInput:"",loading:!1,showConfig:!1,modelConfig:F}},created(){const t=localStorage.getItem("selected_model");t&&(this.config.model=t),this.loadApiKey(),this.loadHistory()},watch:{"config.model":{handler(t){localStorage.setItem("selected_model",t),this.loadApiKey()}},"config.apiKey":{handler(t){t&&this.saveApiKey()}},messages:{handler(t){this.saveHistory()},deep:!0}},methods:{saveApiKey(){if(!this.config.apiKey)return;const t=`api_key_${this.config.model}`;localStorage.setItem(t,this.config.apiKey)},loadApiKey(){const t=`api_key_${this.config.model}`,e=localStorage.getItem(t);this.config.apiKey=e||""},async validateApiKey(){if(!this.config.apiKey)return this.$message.error("请输入API密钥"),!1;try{return await j(this.config.apiKey,this.config.model),!0}catch(t){return this.$message.error("验证API密钥失败："+t.message),!1}},scrollToBottom(){this.$nextTick(()=>{const t=this.$refs.messagesContainer;t&&(t.scrollTop=t.scrollHeight)})},handleEnter(t){t.shiftKey?this.userInput+=`
`:this.sendMessage()},validateInput(){return this.userInput.trim()?!0:(this.$message.warning("请输入内容"),!1)},async sendMessage(){if(this.validateInput()&&await this.validateApiKey()){this.messages.push({role:"user",content:this.userInput.trim()}),this.userInput,this.userInput="",this.loading=!0,this.scrollToBottom();try{const t=await J(this.config.apiKey,this.config.model,this.messages,this.config.temperature);this.messages.push({role:"assistant",content:t.content}),this.scrollToBottom()}catch(t){this.$message.error("请求失败："+t.message)}finally{this.loading=!1}}},saveHistory(){const t=`chat_history_${this.config.model}`;localStorage.setItem(t,JSON.stringify(this.messages))},loadHistory(){const t=`chat_history_${this.config.model}`,e=localStorage.getItem(t);if(e)try{this.messages=JSON.parse(e)}catch(a){console.error("加载历史记录失败:",a),this.messages=[]}},clearHistory(){this.$confirm("确定要清空所有历史对话吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.messages=[],this.saveHistory(),this.$message.success("历史对话已清空")}).catch(()=>{})}}},G={class:"llm-interface"},R={class:"card-header"},X={class:"header-actions"},q={class:"chat-container"},Q={class:"messages",ref:"messagesContainer"},W={class:"message-content"},Y={class:"input-area"},Z={class:"model-description"},$={class:"dialog-footer"};function ee(t,e,a,c,s,d){const p=l("Delete"),_=l("el-icon"),m=l("el-button"),C=l("Setting"),v=l("el-input"),A=l("el-card"),S=l("el-option"),b=l("el-select"),y=l("el-form-item"),V=l("Check"),x=l("el-slider"),E=l("el-form"),M=l("el-dialog");return u(),h("div",G,[o(A,{class:"chat-card"},{header:i(()=>[r("div",R,[e[10]||(e[10]=r("span",null,"对话",-1)),r("div",X,[o(m,{type:"danger",link:"",onClick:d.clearHistory},{default:i(()=>[o(_,null,{default:i(()=>[o(p)]),_:1}),e[8]||(e[8]=f(" 清空历史 "))]),_:1,__:[8]},8,["onClick"]),o(m,{type:"primary",link:"",onClick:e[0]||(e[0]=n=>s.showConfig=!0)},{default:i(()=>[o(_,null,{default:i(()=>[o(C)]),_:1}),e[9]||(e[9]=f(" 设置 "))]),_:1,__:[9]})])])]),default:i(()=>[r("div",q,[r("div",Q,[(u(!0),h(w,null,I(s.messages,(n,P)=>(u(),h("div",{key:P,class:U(["message",n.role])},[r("div",W,k(n.content),1)],2))),128))],512),r("div",Y,[o(v,{modelValue:s.userInput,"onUpdate:modelValue":e[1]||(e[1]=n=>s.userInput=n),type:"textarea",rows:3,placeholder:"请输入您的问题... (按Enter发送，Shift+Enter换行)",onKeydown:N(L(d.handleEnter,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),o(m,{type:"primary",onClick:d.sendMessage,loading:s.loading},{default:i(()=>e[11]||(e[11]=[f(" 发送 ")])),_:1,__:[11]},8,["onClick","loading"])])])]),_:1}),o(M,{modelValue:s.showConfig,"onUpdate:modelValue":e[7]||(e[7]=n=>s.showConfig=n),title:"接口配置",width:"500px","close-on-click-modal":!1},{footer:i(()=>[r("span",$,[o(m,{onClick:e[5]||(e[5]=n=>s.showConfig=!1)},{default:i(()=>e[12]||(e[12]=[f("取消")])),_:1,__:[12]}),o(m,{type:"primary",onClick:e[6]||(e[6]=n=>s.showConfig=!1)},{default:i(()=>e[13]||(e[13]=[f(" 确定 ")])),_:1,__:[13]})])]),default:i(()=>[o(E,{model:s.config,"label-width":"120px"},{default:i(()=>[o(y,{label:"模型选择"},{default:i(()=>[o(b,{modelValue:s.config.model,"onUpdate:modelValue":e[2]||(e[2]=n=>s.config.model=n),placeholder:"请选择模型"},{default:i(()=>[(u(!0),h(w,null,I(Object.values(s.modelConfig),n=>(u(),D(S,{key:n.value,label:n.label,value:n.value},{default:i(()=>[r("span",null,k(n.label),1),r("span",Z,k(n.description),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{label:"API密钥"},{default:i(()=>[o(v,{modelValue:s.config.apiKey,"onUpdate:modelValue":e[3]||(e[3]=n=>s.config.apiKey=n),placeholder:"请输入API密钥","show-password":""},{append:i(()=>[o(m,{onClick:d.saveApiKey,disabled:!s.config.apiKey},{default:i(()=>[o(_,null,{default:i(()=>[o(V)]),_:1})]),_:1},8,["onClick","disabled"])]),_:1},8,["modelValue"])]),_:1}),o(y,{label:"温度"},{default:i(()=>[o(x,{modelValue:s.config.temperature,"onUpdate:modelValue":e[4]||(e[4]=n=>s.config.temperature=n),min:0,max:1,step:.1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const se=B(z,[["render",ee],["__scopeId","data-v-31033949"]]);export{se as default};
//# sourceMappingURL=LLMInterface-0d4472df.js.map
