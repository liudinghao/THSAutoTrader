function T(o,r="HH:mm:00"){const n=new Date(parseInt(o)*1e3),t=n.getHours().toString().padStart(2,"0"),e=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0");return r.replace("HH",t).replace("mm",e).replace("ss",a)}function F(o){return T(o,"HH:mm:00")}function b(o,r){API.use({method:"Quote.syncStockList",data:{id:379,code:o,period:"8192",stocklist:r.join("|")},success:function(n){}})}function R(o,r){var n=window.API.createSessionId("Quote");return console.log("quoteSessionId:",n),window.API.use({method:"Quote.registerPush",data:{code:o.join(",")},sessionId:n,persistent:!0,callbackName:"onready",success:function(t){window.API.use({method:"Quote.getData2",data:{code:o.join(","),type:["NEW","ZHANGDIEFU","ZHANGSHU"],period:"now",mode:"after"},success:function(e){const a=JSON.parse(e);console.log("registerPush:",e),r(a)}})}}),n}function V(o){window.API.use({method:"Quote.unregisterPush",sessionId:o,success:function(r){o=null,customLog("取消监听成功")}})}function G(o){return new Promise((r,n)=>{window.API.use({method:"Quote.setSelfStock",data:{mode:"add",code:o.join(",")},success:function(t){r(t)},error:function(t){n(t)}})})}function J(o){return new Promise((r,n)=>{window.API.use({method:"Util.getBlockStockByCode",data:o,success:function(t){try{const e=t.split(",").filter(a=>a.trim());console.log(`概念 ${o} 获取到 ${e.length} 只股票:`,e),r(e)}catch(e){n(new Error(`解析股票代码失败: ${e.message}`))}},error:function(t){n(new Error(`获取概念股票失败: ${t.message}`))}})})}async function C(o,r=null){return new Promise(async(n,t)=>{try{const e=r||await h(),a={};try{const c=await D(o,e,e);for(const[i,s]of Object.entries(c))s&&s[e]&&s[e].PRE&&(a[i]=parseFloat(s[e].PRE))}catch(c){console.warn("获取昨收价失败，将使用默认值:",c,o,e)}window.API.use({method:"Quote.request",data:{code:o,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",begin:e,withmarket:!1,end:e,timeFmt:1},success:c=>{window.API.use({method:"Quote.getData2",data:{code:o,withmarket:!1,type:["NEW","VOL","JUNJIA","money","ZHANGDIEFU"],period:"min",timeStamp:1,updateMode:1,time:{begin:e,end:e,timeFmt:1}},success:i=>{try{const s=JSON.parse(i);console.log("fetchMinuteData: 获取分时原始数据完成",s);const d={};for(const[l,u]of Object.entries(s)){const E={},P=Object.entries(u);P.forEach(([N,w],f)=>{let p=parseFloat(w.VOL||0);if(f>0){const g=P[f-1][1],A=parseFloat(g.VOL||0);p=Math.max(0,p-A)}let I=parseFloat(w.money||0);if(f>0){const g=P[f-1][1],A=parseFloat(g.money||0);I=Math.max(0,I-A)}const O=F(N),H=parseFloat(w.NEW||w.JUNJIA||0),m=a[l];let y=0;m&&m>0&&(y=(H-m)/m*100),E[O]={...w,VOL:p.toString(),money:I.toString(),changePercent:parseFloat(y.toFixed(2)),preClose:m||null}}),d[l]=E}n(d)}catch(s){console.error("解析分时数据失败:",s),t(s)}},error:i=>{console.error("获取分时详细数据失败:",i),t(i)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})},error:c=>{console.error("请求分时数据失败:",c),t(c)},notClient:()=>{console.error("API客户端不可用"),t(new Error("API客户端不可用"))}})}catch(e){console.error("fetchMinuteData 执行失败:",e),t(e)}})}async function Q(o){return new Promise((r,n)=>{window.API.use({method:"Quote.request",data:{code:o,type:["NEW","ZHANGDIEFU","OPEN"],period:"now"},callbackName:"onready",success:t=>{window.API.use({method:"Quote.getData2",data:{code:o,type:["NEW","ZHANGDIEFU","OPEN"],period:"now",mode:"after"},success:e=>{try{const a=JSON.parse(e),c={};for(const[i,s]of Object.entries(a)){const d=parseFloat(s.NEW),l=parseFloat(s.ZHANGDIEFU);let u=null;!isNaN(d)&&!isNaN(l)&&(u=d/(1+l/100),u=parseFloat(u.toFixed(4))),c[i]={NEW:s.NEW,PRE:u?u.toString():null,ZHANGDIEFU:s.ZHANGDIEFU,OPEN:s.OPEN}}r(c)}catch(a){console.error("解析实时行情数据失败:",a),n(a)}},error:e=>{console.error("获取实时行情详细数据失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})},error:t=>{console.error("请求实时行情数据失败:",t,o),n(t)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}async function D(o,r,n){return new Promise((t,e)=>{const a=Array.isArray(o)?o:[o];window.API.use({method:"Quote.request",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",begin:r,end:n},success:function(c){window.API.use({method:"Quote.getData2",data:{code:a,type:["OPEN","CLOSE","PRE","VOL","money"],period:"day",mode:"after",time:{begin:r,end:n,timeFmt:1},updateMode:1},success:function(i){try{const s=JSON.parse(i);t(s)}catch(s){console.error("解析历史数据失败:",s),e(s)}},error:function(i){console.error("获取历史详细数据失败:",i),e(i)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})},error:function(c){console.error("请求历史数据失败:",c),e(c)},notClient:()=>{console.error("API客户端不可用"),e(new Error("API客户端不可用"))}})})}function h(o=null){return new Promise((r,n)=>{const t=o||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getSHTradeDate",data:t,success:function(e){r(e)},error:function(e){console.error("获取最近交易日失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function $(o=null){return new Promise((r,n)=>{const t=o||new Date().toISOString().slice(0,10).replace(/-/g,"");window.API.use({method:"Quote.getPreSHTradeDate",data:t,success:function(e){r(e)},error:function(e){console.error("获取最近交易日失败:",e),n(e)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function M(o="300033"){return new Promise((r,n)=>{window.API.use({method:"Quote.isTradeTime",data:o,success:function(t){console.log("是否在交易时间内:",t),r(t)},error:function(t){console.error("检查交易时间失败:",t),n(t)},notClient:()=>{console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function S(o=1){return new Promise((r,n)=>{window.API.use({method:"Util.getAllBlockCode",data:{needMarket:o},success:function(t){try{const a=t.split(",").filter(c=>c.trim()).map(c=>{const[i,s]=c.split(":");return{code:s||"",marketId:i||""}});r(a)}catch(e){n(new Error(`解析股票代码失败: ${e.message}`))}},error:function(t){console.error("获取板块代码失败:",t),n(t)},notClient:function(){console.error("API客户端不可用"),n(new Error("API客户端不可用"))}})})}function U(o,r,n="",t=""){return new Promise((e,a)=>{const c=`<?xml version="1.0" encoding="GB2312"?><RealTime StockCode="${r}" Market="33"><Bid><Price Selected="1">${n}</Price><Amount>${t}</Amount></Bid></RealTime>`,i=`wt_startup=wt_startup=\r
realtime=`+window.btoa(unescape(encodeURIComponent(c)));window.API.use({method:"XdMgr.fastCallXiadan",data:{cmd:o===0?"XD_MAIRU":"XD_MAICHU",code:r,amount:t,info:i,default:!1,hide:!1,select:!0},success:function(s){console.log(`${o===0?"买入":"卖出"}下单成功:`,r,s),e(s)},error:function(s){console.error(`${o===0?"买入":"卖出"}下单失败:`,r,s),a(s)},notClient:function(){const s="API客户端不可用";console.error(s),a(new Error(s))}})})}async function k(){const o=new Date().toISOString().slice(0,10).replace(/-/g,""),r=await h(o);return o===r}function L(){const o=new Date,r=o.getHours(),n=o.getMinutes(),t=r*100+n;return t>=915&&t<925||t>=930&&t<1130||t>=1300&&t<1500}async function W(){if(!L())return!1;try{return await k()}catch(o){return console.error("判断交易日失败:",o),!1}}window.getAllStockCodes=S;window.getAllBlockCode=S;window.placeOrder=U;window.getLatestTradeDate=h;window.fetchMinuteData=C;window.fetchRealTimeQuote=Q;window.fetchHistoryData=D;window.isTradeTime=M;export{C as a,S as b,Q as c,h as d,W as e,D as f,$ as g,G as h,M as i,b as j,J as k,R as r,V as u};
//# sourceMappingURL=quoteApi-eb2c207c.js.map
