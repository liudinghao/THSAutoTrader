import{f as A}from"./quoteApi-eb2c207c.js";import{a as N}from"./axios-3a665b0f.js";const C={MIN_CHANGE_PERCENT:3,MAX_CHANGE_PERCENT:5,BATCH_SIZE:100,BATCH_DELAY:200,API_URL:"https://www.wttiao.com/moni/ztpool/auction-preselect"};async function H(n={}){const{date:t,minChange:a=C.MIN_CHANGE_PERCENT,maxChange:o=C.MAX_CHANGE_PERCENT,onProgress:e}=n;if(!t)throw new Error("请指定回测日期");const r={date:t,originalCount:0,filteredCount:0,stocks:[],filterCriteria:{minChange:a,maxChange:o},executionTime:Date.now()};try{e&&e("正在获取预选股票列表...",0);const c=await w(t);r.originalCount=c.length,e&&e(`获取到 ${c.length} 只预选股票，开始计算竞价涨跌幅...`,20);const l=await P(c,t,e),s=x(l,a,o);return r.filteredCount=s.length,r.stocks=s,r.executionTime=Date.now()-r.executionTime,e&&e(`策略执行完成，找到 ${s.length} 只符合条件的股票`,100),r}catch(c){throw console.error("竞价选股策略执行失败:",c),new Error(`竞价选股策略执行失败: ${c.message}`)}}async function w(n){try{const t=await N.get(C.API_URL,{params:{date:n}});if(t.data.code!==0)throw new Error(`API返回错误: ${t.data.msg}`);return t.data.data||[]}catch(t){throw new Error(`获取预选股票失败: ${t.message}`)}}async function P(n,t,a){const{BATCH_SIZE:o,BATCH_DELAY:e}=C,r=t.replace(/-/g,""),c=[],l=Math.ceil(n.length/o);for(let s=0;s<n.length;s+=o){const u=n.slice(s,s+o),f=Math.floor(s/o)+1;try{const h=20+f/l*60;a&&a(`正在处理第 ${f}/${l} 批股票 (${u.length} 只)`,h);const g=u.map(i=>i.code),_=await A(g,r,r);u.forEach(i=>{const E=i.code,d=_[E],m=T(d,r),p=y(d,r);c.push({...i,auction_change:m,close_change:p,market_code:E})}),s+o<n.length&&await new Promise(i=>setTimeout(i,e))}catch(h){console.error(`第 ${f} 批股票获取行情数据失败:`,h),u.forEach(g=>{c.push({...g,auction_change:null,close_change:null,market_code:g.code,error:h.message})})}}return c}function T(n,t){if(!n||!n[t])return null;const a=n[t],o=parseFloat(a.OPEN),e=parseFloat(a.PRE);if(isNaN(o)||isNaN(e)||e<=0)return null;const r=(o-e)/e*100;return parseFloat(r.toFixed(2))}function y(n,t){if(!n||!n[t])return null;const a=n[t],o=parseFloat(a.CLOSE),e=parseFloat(a.PRE);if(isNaN(o)||isNaN(e)||e<=0)return null;const r=(o-e)/e*100;return parseFloat(r.toFixed(2))}function x(n,t,a){return n.filter(o=>{const e=o.auction_change;return e!=null&&e>=t&&e<=a})}export{H as e};
//# sourceMappingURL=auctionPreselect-80acad08.js.map
