{"version":3,"file":"indexedDB-6e3beb73.js","sources":["../../front/src/utils/indexedDB.js"],"sourcesContent":["const DB_NAME = 'THSAutoTrader';\r\nconst DB_VERSION = 2;\r\nconst STORES = {\r\n  ASSET_INFO: 'assetInfo',\r\n  POSITION_DATA: 'positionData',\r\n  KLINE_DATA: 'klineData',\r\n};\r\n\r\nclass IndexedDBUtil {\r\n  constructor() {\r\n    this.db = null;\r\n  }\r\n\r\n  // 初始化数据库\r\n  async init() {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = (event) => {\r\n        reject('数据库打开失败');\r\n      };\r\n\r\n      request.onsuccess = (event) => {\r\n        this.db = event.target.result;\r\n        resolve();\r\n      };\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = event.target.result;\r\n        // 创建资产信息存储\r\n        if (!db.objectStoreNames.contains(STORES.ASSET_INFO)) {\r\n          db.createObjectStore(STORES.ASSET_INFO, { keyPath: 'id' });\r\n        }\r\n        // 创建持仓数据存储\r\n        if (!db.objectStoreNames.contains(STORES.POSITION_DATA)) {\r\n          db.createObjectStore(STORES.POSITION_DATA, { keyPath: 'id' });\r\n        }\r\n        // 创建 K 线数据存储\r\n        if (!db.objectStoreNames.contains(STORES.KLINE_DATA)) {\r\n          db.createObjectStore(STORES.KLINE_DATA, { keyPath: 'code' });\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  // 保存数据\r\n  async saveData(storeName, data, key = 1) {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction([storeName], 'readwrite');\r\n      const store = transaction.objectStore(storeName);\r\n      const request = store.put({\r\n        [storeName === STORES.KLINE_DATA ? 'code' : 'id']: key,\r\n        data,\r\n        timestamp: Date.now(),\r\n      });\r\n\r\n      request.onsuccess = () => resolve();\r\n      request.onerror = () => reject('数据保存失败');\r\n    });\r\n  }\r\n\r\n  // 获取数据\r\n  async getData(storeName, key = 1) {\r\n    if (!this.db) {\r\n      await this.init();\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      const transaction = this.db.transaction([storeName], 'readonly');\r\n      const store = transaction.objectStore(storeName);\r\n      const request = store.get(key);\r\n\r\n      request.onsuccess = () => resolve(request.result);\r\n      request.onerror = () => reject('数据获取失败');\r\n    });\r\n  }\r\n\r\n  // 检查数据是否过期（默认5分钟）\r\n  isDataExpired(timestamp, maxAge = 5 * 60 * 1000) {\r\n    // 返回 false 表示数据永不过期\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const indexedDBUtil = new IndexedDBUtil();\r\nexport const STORE_NAMES = STORES;\r\nexport { DB_NAME, DB_VERSION };\r\n"],"names":["DB_NAME","STORES","IndexedDBUtil","resolve","reject","request","event","db","storeName","data","key","timestamp","maxAge","indexedDBUtil","STORE_NAMES"],"mappings":"AAAA,MAAMA,EAAU,gBAEhB,MAAMC,EAAS,CACb,WAAY,YACZ,cAAe,eACf,WAAY,WACd,EAEA,MAAMC,CAAc,CAClB,aAAc,CACZ,KAAK,GAAK,IACX,CAGD,MAAM,MAAO,CACX,OAAO,IAAI,QAAQ,CAACC,EAASC,IAAW,CACtC,MAAMC,EAAU,UAAU,KAAKL,EAAS,CAAU,EAElDK,EAAQ,QAAWC,GAAU,CAC3BF,EAAO,SAAS,CACxB,EAEMC,EAAQ,UAAaC,GAAU,CAC7B,KAAK,GAAKA,EAAM,OAAO,OACvBH,GACR,EAEME,EAAQ,gBAAmBC,GAAU,CACnC,MAAMC,EAAKD,EAAM,OAAO,OAEnBC,EAAG,iBAAiB,SAASN,EAAO,UAAU,GACjDM,EAAG,kBAAkBN,EAAO,WAAY,CAAE,QAAS,IAAI,CAAE,EAGtDM,EAAG,iBAAiB,SAASN,EAAO,aAAa,GACpDM,EAAG,kBAAkBN,EAAO,cAAe,CAAE,QAAS,IAAI,CAAE,EAGzDM,EAAG,iBAAiB,SAASN,EAAO,UAAU,GACjDM,EAAG,kBAAkBN,EAAO,WAAY,CAAE,QAAS,MAAM,CAAE,CAErE,CACA,CAAK,CACF,CAGD,MAAM,SAASO,EAAWC,EAAMC,EAAM,EAAG,CACvC,OAAK,KAAK,IACR,MAAM,KAAK,OAEN,IAAI,QAAQ,CAACP,EAASC,IAAW,CAGtC,MAAMC,EAFc,KAAK,GAAG,YAAY,CAACG,CAAS,EAAG,WAAW,EACtC,YAAYA,CAAS,EACzB,IAAI,CACxB,CAACA,IAAcP,EAAO,WAAa,OAAS,IAAI,EAAGS,EACnD,KAAAD,EACA,UAAW,KAAK,IAAK,CAC7B,CAAO,EAEDJ,EAAQ,UAAY,IAAMF,IAC1BE,EAAQ,QAAU,IAAMD,EAAO,QAAQ,CAC7C,CAAK,CACF,CAGD,MAAM,QAAQI,EAAWE,EAAM,EAAG,CAChC,OAAK,KAAK,IACR,MAAM,KAAK,OAEN,IAAI,QAAQ,CAACP,EAASC,IAAW,CAGtC,MAAMC,EAFc,KAAK,GAAG,YAAY,CAACG,CAAS,EAAG,UAAU,EACrC,YAAYA,CAAS,EACzB,IAAIE,CAAG,EAE7BL,EAAQ,UAAY,IAAMF,EAAQE,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAMD,EAAO,QAAQ,CAC7C,CAAK,CACF,CAGD,cAAcO,EAAWC,EAAS,EAAI,GAAK,IAAM,CAE/C,MAAO,EACR,CACH,CAEY,MAACC,EAAgB,IAAIX,EACpBY,EAAcb"}